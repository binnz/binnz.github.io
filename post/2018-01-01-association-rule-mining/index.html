<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mining Association Rules on New York City Bike Dataset - California Dreaming</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
  
  <meta name="description" content="What   we   want   to   do here   is  to design 3 mining tasks with their definitions of transactions and   find   some   rules   behind them.
For   each   task,   we   should

Try at   least   two   discretization   methods (divided   by 10, divided   by   20, &hellip;)
Try at   least two   algorithms (Apriori, FP-growth, &hellip;) to   find   association   rules.
List the interesting  rules.
Compare   the   differences   between   them.
">
  
  <meta itemprop="name" content="Mining Association Rules on New York City Bike Dataset - California Dreaming">
  <meta itemprop="description" content="What   we   want   to   do here   is  to design 3 mining tasks with their definitions of transactions and   find   some   rules   behind them.
For   each   task,   we   should

Try at   least   two   discretization   methods (divided   by 10, divided   by   20, &hellip;)
Try at   least two   algorithms (Apriori, FP-growth, &hellip;) to   find   association   rules.
List the interesting  rules.
Compare   the   differences   between   them.
">
  <meta itemprop="image" content="https://binnz.github.io/img/author.jpg">
  
  
  <meta name="twitter:description" content="">
  
  <link rel="shortcut icon" href="https://binnz.github.io/img/favicon.ico"/>
  <link rel="apple-touch-icon" href="https://binnz.github.io/apple-touch-icon.png" />
  <link rel="apple-touch-icon-precomposed" href="https://binnz.github.io/apple-touch-icon.png" />
  <link rel="stylesheet" href="https://binnz.github.io/highlight/styles/github.css">
  <script src="https://binnz.github.io/highlight/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  
  <link rel="stylesheet" href="https://binnz.github.io/font/hack/css/hack.min.css">
  <link rel="stylesheet" href="https://binnz.github.io/css/style.css">
</head>

<body>
  <header>
    <div>
  <div style="height:150px; width:100%; clear:both;"></div>
  <div id="textlogo">
    <h1 class="site-name"><a href="https://binnz.github.io/" title="California Dreaming">California Dreaming</a></h1>
    <h2 class="blog-motto"></h2>
  </div>
  <div class="navbar"><a class="navbutton navmobile" href="#" title="menu"></a></div>
			<div style="height:50px; width:100%; clear:both;"></div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="menu">
			</a><div style="height:50px; width:100%; clear:both;"></div></div>
  <nav class="animated">
    <ul>
      
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/post/">Archives</a></li>
      
      <li><a href="/tags/">Tags</a></li>
      
      
      <li>
        <form class="search" method="get" action="https://www.google.com/search">
          <div>
            <input type="text" id="search" name="q" placeholder='Search'>
          </div>
        </form>
      </li>
    </ul>
  </nav>
</div>

  </header>
  <div id="container">
    <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody">
    <header class="article-info clearfix">
  <h1 itemprop="name">
      <a href="https://binnz.github.io/post/2018-01-01-association-rule-mining/" title="Mining Association Rules on New York City Bike Dataset" itemprop="url">Mining Association Rules on New York City Bike Dataset</a>
  </h1>
  <p class="article-author">By
    
      <a href="" title="">you</a>
    
  </p>
  <p class="article-time">
    <time datetime="2018-01-01 00:00:00 &#43;0000 UTC" itemprop="datePublished">2018-01-01</time>
  </p>
</header>

	<div class="article-content">
    
    <p>What   we   want   to   do here   is  to design 3 mining tasks with their definitions of transactions and   find   some   rules   behind them.</p>
<p>For   each   task,   we   should</p>
<ul>
<li>Try <strong>at   least   two   discretization   methods</strong> (divided   by 10, divided   by   20, &hellip;)</li>
<li>Try <strong>at   least two   algorithms</strong> (Apriori, FP-growth, &hellip;) to   find   association   rules.</li>
<li>List the interesting  rules.</li>
<li><strong>Compare</strong>   the   differences   between   them.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.basemap</span> <span class="kn">import</span> <span class="n">Basemap</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="dataset">Dataset</h2>
<p><a href="https://www.citibikenyc.com/system-data">New   York   Citi   Bike   Trip   Histories</a></p>
<p>We&rsquo;ll   use   <a href="https://s3.amazonaws.com/tripdata/201707-citibike-tripdata.csv.zip"><code>201707-citibike-tripdata.csv.zip</code></a>   in   this   homework   only.</p>
<h3 id="a-schema">A. Schema</h3>
<p>We have already preprocessed this dataset into the following 2 data frames:</p>
<p><strong>1. Every Station&rsquo;s Information</strong></p>
<ul>
<li><code>Station ID</code></li>
<li><code>Station Name</code></li>
<li><code>Station Latitude</code></li>
<li><code>Station Longitude</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">df_loc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&#34;data/station_information.csv&#34;</span><span class="p">)</span>
<span class="n">df_loc</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }
<pre><code>.dataframe thead th {
    text-align: left;
}

.dataframe tbody tr th {
    vertical-align: top;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>station id</th>
      <th>station name</th>
      <th>station latitude</th>
      <th>station longitude</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>539</td>
      <td>Metropolitan Ave &amp; Bedford Ave</td>
      <td>40.715348</td>
      <td>-73.960241</td>
    </tr>
    <tr>
      <th>1</th>
      <td>293</td>
      <td>Lafayette St &amp; E 8 St</td>
      <td>40.730207</td>
      <td>-73.991026</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3242</td>
      <td>Schermerhorn St &amp; Court St</td>
      <td>40.691029</td>
      <td>-73.991834</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2002</td>
      <td>Wythe Ave &amp; Metropolitan Ave</td>
      <td>40.716887</td>
      <td>-73.963198</td>
    </tr>
    <tr>
      <th>4</th>
      <td>361</td>
      <td>Allen St &amp; Hester St</td>
      <td>40.716059</td>
      <td>-73.991908</td>
    </tr>
  </tbody>
</table>
</div>
<p><strong>2. Every Station&rsquo;s Flow Data</strong></p>
<ul>
<li><code>Station ID</code></li>
<li><code>Time</code>: One day is splitted into 48 segments in this case. (Every 30 minutes)</li>
<li><code>In Flow Count</code>: The number of trips move to the station</li>
<li><code>Out Flow Count</code>: The number of trips move from the station</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">df_flow</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&#34;data/station_flow.csv&#34;</span><span class="p">)</span>
<span class="n">df_flow</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_flow</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
<span class="n">df_flow</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }
<pre><code>.dataframe thead th {
    text-align: left;
}

.dataframe tbody tr th {
    vertical-align: top;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>station id</th>
      <th>time</th>
      <th>in_flow_count</th>
      <th>out_flow_count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>72</td>
      <td>2017-07-01 00:00:00</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>72</td>
      <td>2017-07-01 10:00:00</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>72</td>
      <td>2017-07-01 10:30:00</td>
      <td>7.0</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>72</td>
      <td>2017-07-01 11:00:00</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>72</td>
      <td>2017-07-01 12:00:00</td>
      <td>2.0</td>
      <td>6.0</td>
    </tr>
  </tbody>
</table>
</div>
<h3 id="b-algorithms">B. Algorithms</h3>
<ul>
<li>
<p><strong>Apriori</strong></p>
<ul>
<li>Github repository: <a href="https://github.com/ymoch/apyori">https://github.com/ymoch/apyori</a></li>
<li>How to Use: Install with pip: <code>pip install apyori</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">The MIT License (MIT)

Copyright (c) 2016 Yu Mochizuki

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the &#34;Software&#34;), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED &#34;AS IS&#34;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">apyori</span> <span class="kn">import</span> <span class="n">apriori</span>

<span class="k">def</span> <span class="nf">apriori_find_association_rules</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">minsup</span><span class="p">,</span> <span class="n">minconf</span><span class="p">):</span>
    <span class="n">records</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">apriori</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">min_support</span><span class="o">=</span><span class="n">minsup</span><span class="p">,</span> <span class="n">min_confidence</span><span class="o">=</span><span class="n">minconf</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">records</span>

<span class="k">def</span> <span class="nf">apriori_show_mining_results</span><span class="p">(</span><span class="n">records</span><span class="p">):</span>
    <span class="n">ap</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">records</span><span class="p">:</span>
        <span class="n">converted_record</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">ordered_statistics</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">record</span><span class="o">.</span><span class="n">ordered_statistics</span><span class="p">])</span>
        <span class="n">ap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">converted_record</span><span class="o">.</span><span class="n">_asdict</span><span class="p">())</span>
    
    <span class="c1">#print(&#34;Frequent Itemsets:\n------------------&#34;)</span>
    <span class="c1">#for ptn in ap:</span>
    <span class="c1">#    print(&#39;({})  support = {}&#39;.format(&#34;, &#34;.join(ptn[&#34;items&#34;]), round(ptn[&#34;support&#34;], 3)))</span>
    <span class="c1">#print()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Rules:</span><span class="se">\n</span><span class="s2">------&#34;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ptn</span> <span class="ow">in</span> <span class="n">ap</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">ptn</span><span class="p">[</span><span class="s2">&#34;ordered_statistics&#34;</span><span class="p">]:</span>
            <span class="n">head</span> <span class="o">=</span> <span class="n">rule</span><span class="p">[</span><span class="s2">&#34;items_base&#34;</span><span class="p">]</span>
            <span class="n">tail</span> <span class="o">=</span> <span class="n">rule</span><span class="p">[</span><span class="s2">&#34;items_add&#34;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">head</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">tail</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">confidence</span> <span class="o">=</span> <span class="n">rule</span><span class="p">[</span><span class="s2">&#34;confidence&#34;</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;(</span><span class="si">{}</span><span class="s1">) ==&gt; (</span><span class="si">{}</span><span class="s1">)  confidence = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">head</span><span class="p">),</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tail</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">confidence</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p><strong>FP-Growth</strong></p>
<ul>
<li>Github repository: <a href="https://github.com/evandempsey/fp-growth">https://github.com/evandempsey/fp-growth</a></li>
<li>How to Use: Install with pip: <code>pip install pyfpgrowth</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Copyright (c) 2016, Evan Dempsey
All rights reserved.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted, provided that the above
copyright notice and this permission notice appear in all copies.

THE SOFTWARE IS PROVIDED &#34;AS IS&#34; AND THE AUTHOR DISCLAIMS ALL WARRANTIES
WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pyfpgrowth</span>

<span class="k">def</span> <span class="nf">fp_find_association_rules</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">minsup</span><span class="p">,</span> <span class="n">minconf</span><span class="p">):</span>
    <span class="n">patterns</span> <span class="o">=</span> <span class="n">pyfpgrowth</span><span class="o">.</span><span class="n">find_frequent_patterns</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">minsup</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">))</span>
    <span class="n">rules</span> <span class="o">=</span> <span class="n">pyfpgrowth</span><span class="o">.</span><span class="n">generate_association_rules</span><span class="p">(</span><span class="n">patterns</span><span class="p">,</span> <span class="n">minconf</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">patterns</span><span class="p">,</span> <span class="n">rules</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">fp_show_mining_results</span><span class="p">(</span><span class="n">ap</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="p">(</span><span class="n">patterns</span><span class="p">,</span> <span class="n">rules</span><span class="p">)</span> <span class="o">=</span> <span class="n">ap</span>
    <span class="c1">#print(&#34;Frequent Itemsets:\n------------------&#34;)</span>
    <span class="c1">#for key, val in patterns.items():</span>
    <span class="c1">#    print(&#39;{}  support = {}&#39;.format(key, round(val/N, 3)))</span>
    <span class="c1">#print()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Rules:</span><span class="se">\n</span><span class="s2">------&#34;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">rules</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">head</span> <span class="o">=</span> <span class="n">key</span>
        <span class="n">tail</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">confidence</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tail</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;(</span><span class="si">{}</span><span class="s1">) ==&gt; (</span><span class="si">{}</span><span class="s1">)  confidence = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">head</span><span class="p">),</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tail</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">confidence</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="task-1-find-rules-between-in-flow-and-out-flow-of-station-519">Task 1: Find Rules between <code>in-flow</code> and <code>out-flow</code> of Station <code>519</code></h2>
<p>The first task is that we want to find that if there is any association rules between in-flow counts and out-flow counts of station <code>519</code>.</p>
<p>For example,</p>
<p>$$
{High~inflow~count} \rightarrow {High~outflow~count}
$$</p>
<h3 id="a-define-transactions">A. Define Transactions</h3>
<p>A   transaction   consists of</p>
<ul>
<li><code>in-flow</code> for <code>station id = 519</code></li>
<li><code>out-flow</code> for <code>station id = 519</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">dat</span> <span class="o">=</span> <span class="n">df_flow</span><span class="p">[</span><span class="n">df_flow</span><span class="p">[</span><span class="s1">&#39;station id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">519</span><span class="p">][[</span><span class="s1">&#39;in_flow_count&#39;</span><span class="p">,</span> <span class="s1">&#39;out_flow_count&#39;</span><span class="p">]]</span>
<span class="n">dat</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }
<pre><code>.dataframe thead th {
    text-align: left;
}

.dataframe tbody tr th {
    vertical-align: top;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>in_flow_count</th>
      <th>out_flow_count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>244329</th>
      <td>3.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>244330</th>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>244331</th>
      <td>1.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>244332</th>
      <td>4.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>244333</th>
      <td>7.0</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>
</div>
<p>Let&rsquo;s do some <strong>observations</strong> on the transaction dataset.</p>
<ol>
<li>Make sure there is no missing values.</li>
<li>See the minimum/maximum of flow counts values</li>
<li>See the distribution of flow counts values.</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>in_flow_count     0
out_flow_count    0
dtype: int64
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Min: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">Max: </span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">dat</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>Min: 0.0
Max: 116.0
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">dat</span><span class="p">[</span><span class="s1">&#39;in_flow_count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&#34;in flow count&#34;</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">dat</span><span class="p">[</span><span class="s1">&#39;out_flow_count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&#34;out flow count&#34;</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">dat</span><span class="p">[</span><span class="s1">&#39;in_flow_count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&#34;in flow count (log scale)&#34;</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">dat</span><span class="p">[</span><span class="s1">&#39;out_flow_count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&#34;out flow count (log scale)&#34;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="https://i.imgur.com/CMVDI75.png" alt=""></p>
<p>It is found that the flow counts values <strong>highly concentrates</strong> in the interval <code>0~20</code>.</p>
<p>I&rsquo;m going to use the <code>pandas</code> functions <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.cut.html"><strong><code>cut</code></strong></a>  and <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.qcut.html"><strong><code>qcut</code></strong></a> to split intervals of in/out flow counts.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="n">cut</span><span class="w">
</span><span class="w"></span><span class="o">-</span><span class="w"> </span><span class="o">`</span><span class="n">bins</span><span class="o">`</span><span class="p">:</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">scalars</span><span class="p">,</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">IntervalIndex</span><span class="w">
</span><span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="k">If</span><span class="w"> </span><span class="n">bins</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">defines</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">equal</span><span class="o">-</span><span class="n">width</span><span class="w"> </span><span class="n">bins</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="w">
</span><span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="k">If</span><span class="w"> </span><span class="n">bins</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">defines</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">bin</span><span class="w"> </span><span class="n">edges</span><span class="w"> </span><span class="n">allowing</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">non</span><span class="o">-</span><span class="n">uniform</span><span class="w"> </span><span class="n">bin</span><span class="w"> </span><span class="n">width</span><span class="p">.</span><span class="w">
</span><span class="w"></span><span class="o">-</span><span class="w"> </span><span class="o">`</span><span class="n">labels</span><span class="o">`</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">array</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">boolean</span><span class="p">,</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">None</span><span class="w">
</span><span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">Used</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">resulting</span><span class="w"> </span><span class="n">bins</span><span class="p">.</span><span class="w"> 
</span><span class="w"> 
</span><span class="w">
</span><span class="w"></span><span class="n">qcut</span><span class="w">
</span><span class="w"></span><span class="o">-</span><span class="w"> </span><span class="o">`</span><span class="n">q</span><span class="o">`</span><span class="p">:</span><span class="w"> </span><span class="kt">integer</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">array</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">quantiles</span><span class="w">
</span><span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="k">If</span><span class="w"> </span><span class="n">bins</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">defines</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">quantiles</span><span class="p">.</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">deciles</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">quartiles</span><span class="p">,</span><span class="w"> </span><span class="n">etc</span><span class="p">.</span><span class="w"> 
</span><span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="k">If</span><span class="w"> </span><span class="n">bins</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">array</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">defines</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">array</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">quantiles</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="mi">75</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">.]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">quartiles</span><span class="p">.</span><span class="w">
</span><span class="w"></span><span class="o">-</span><span class="w"> </span><span class="o">`</span><span class="n">labels</span><span class="o">`</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">array</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">boolean</span><span class="p">,</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">None</span><span class="w">
</span><span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">Used</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">resulting</span><span class="w"> </span><span class="n">bins</span><span class="p">.</span><span class="w"> 
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p><strong>Discretization Method (1). <code>equi-sized</code> approach</strong></p>
<p>With <code>equi-sized</code> approach, I partition the continuous domain into intervals with equal length.
Here I also define their labels:</p>
<blockquote>
<ul>
<li><code>&quot;level-1&quot; = size 0%~20%</code></li>
<li><code>&quot;level-2&quot; = size 20%~40%</code></li>
<li><code>&quot;level-3&quot; = size 40%~60%</code></li>
<li><code>&quot;level-4&quot; = size 60%~80%</code></li>
<li><code>&quot;level-5&quot; = size 80%~100%</code></li>
</ul>
</blockquote>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">dat_1</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">dat_1</span><span class="p">[</span><span class="s1">&#39;in_flow_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">dat_1</span><span class="p">[</span><span class="s1">&#39;in_flow_count&#39;</span><span class="p">],</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> \
                                <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;in.level-1&#34;</span><span class="p">,</span> <span class="s2">&#34;in.level-2&#34;</span><span class="p">,</span> <span class="s2">&#34;in.level-3&#34;</span><span class="p">,</span> \
                                          <span class="s2">&#34;in.level-4&#34;</span><span class="p">,</span> <span class="s2">&#34;in.level-5&#34;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;in_flow_count&#39;</span><span class="p">],</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>(-0.091, 18.2]    1263
(18.2, 36.4]       141
(36.4, 54.6]        48
(54.6, 72.8]        34
(72.8, 91.0]         2
Name: in_flow_count, dtype: int64
</code></pre>
<table>
<thead>
<tr>
<th>Label</th>
<th>Interval</th>
<th>Depth (Number of Instances)</th>
</tr>
</thead>
<tbody>
<tr>
<td>in.level-1</td>
<td>(-0.091, 18.2]</td>
<td>1263</td>
</tr>
<tr>
<td>in.level-2</td>
<td>(18.2, 36.4]</td>
<td>141</td>
</tr>
<tr>
<td>in.level-3</td>
<td>(36.4, 54.6]</td>
<td>48</td>
</tr>
<tr>
<td>in.level-4</td>
<td>(54.6, 72.8]</td>
<td>34</td>
</tr>
<tr>
<td>in.level-5</td>
<td>(72.8, 91.0]</td>
<td>2</td>
</tr>
</tbody>
</table>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">dat_1</span><span class="p">[</span><span class="s1">&#39;out_flow_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">dat_1</span><span class="p">[</span><span class="s1">&#39;out_flow_count&#39;</span><span class="p">],</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> \
                                <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;out.level-1&#34;</span><span class="p">,</span> <span class="s2">&#34;out.level-2&#34;</span><span class="p">,</span> <span class="s2">&#34;out.level-3&#34;</span><span class="p">,</span> \
                                          <span class="s2">&#34;out.level-4&#34;</span><span class="p">,</span> <span class="s2">&#34;out.level-5&#34;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;out_flow_count&#39;</span><span class="p">],</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>(-0.116, 23.2]    1317
(23.2, 46.4]       111
(46.4, 69.6]        40
(69.6, 92.8]        18
(92.8, 116.0]        2
Name: out_flow_count, dtype: int64
</code></pre>
<table>
<thead>
<tr>
<th>Label</th>
<th>Interval</th>
<th>Depth (Number of Instances)</th>
</tr>
</thead>
<tbody>
<tr>
<td>out.level-1</td>
<td>(-0.116, 23.2]</td>
<td>1317</td>
</tr>
<tr>
<td>out.level-2</td>
<td>(23.2, 46.4]</td>
<td>111</td>
</tr>
<tr>
<td>out.level-3</td>
<td>(46.4, 69.6]</td>
<td>40</td>
</tr>
<tr>
<td>out.level-4</td>
<td>(69.6, 92.8]</td>
<td>18</td>
</tr>
<tr>
<td>out.level-5</td>
<td>(92.8, 116.0]</td>
<td>2</td>
</tr>
</tbody>
</table>
<ul>
<li>
<p><strong>Discretization Method (2). <code>equi-depth</code> approach</strong></p>
<p>With <code>equi-depth</code> approach, I partition the data values into intervals with equal size along the ordering of the data.</p>
<p>Here I also define their labels:</p>
<blockquote>
<ul>
<li><code>&quot;zero&quot; = quantile 0~20</code></li>
<li><code>&quot;extreme-low&quot; = quantile 20~40</code></li>
<li><code>&quot;low&quot; = quantile 40~60</code></li>
<li><code>&quot;medium&quot; = quantile 60~80</code></li>
<li><code>&quot;high&quot; = quantile 80~100</code></li>
</ul>
</blockquote>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">dat_2</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">dat_2</span><span class="p">[</span><span class="s1">&#39;in_flow_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">dat_2</span><span class="p">[</span><span class="s1">&#39;in_flow_count&#39;</span><span class="p">],</span> <span class="n">q</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> \
                                <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;in.zero&#34;</span><span class="p">,</span> <span class="s2">&#34;in.extreme-low&#34;</span><span class="p">,</span> <span class="s2">&#34;in.low&#34;</span><span class="p">,</span> \
                                          <span class="s2">&#34;in.medium&#34;</span><span class="p">,</span> <span class="s2">&#34;in.high&#34;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;in_flow_count&#39;</span><span class="p">],</span> <span class="n">q</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>(-0.001, 1.0]    403
(3.0, 7.0]       315
(7.0, 14.0]      283
(14.0, 91.0]     278
(1.0, 3.0]       209
Name: in_flow_count, dtype: int64
</code></pre>
<table>
<thead>
<tr>
<th>Label</th>
<th>Interval</th>
<th>Depth (Number of Instances)</th>
</tr>
</thead>
<tbody>
<tr>
<td>in.zero</td>
<td>(-0.001, 1.0]</td>
<td>403</td>
</tr>
<tr>
<td>in.extreme-low</td>
<td>(1.0, 3.0]</td>
<td>209</td>
</tr>
<tr>
<td>in.low</td>
<td>(3.0, 7.0]</td>
<td>315</td>
</tr>
<tr>
<td>in.medium</td>
<td>(7.0, 14.0]</td>
<td>283</td>
</tr>
<tr>
<td>in.high</td>
<td>(14.0, 91.0]</td>
<td>278</td>
</tr>
</tbody>
</table>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">dat_2</span><span class="p">[</span><span class="s1">&#39;out_flow_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">dat_2</span><span class="p">[</span><span class="s1">&#39;out_flow_count&#39;</span><span class="p">],</span> <span class="n">q</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> \
                                <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;out.zero&#34;</span><span class="p">,</span> <span class="s2">&#34;out.extreme-low&#34;</span><span class="p">,</span> <span class="s2">&#34;out.low&#34;</span><span class="p">,</span> \
                                          <span class="s2">&#34;out.medium&#34;</span><span class="p">,</span> <span class="s2">&#34;out.high&#34;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;out_flow_count&#39;</span><span class="p">],</span> <span class="n">q</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>(-0.001, 1.0]    423
(3.0, 7.0]       307
(7.0, 14.0]      292
(14.0, 116.0]    284
(1.0, 3.0]       182
Name: out_flow_count, dtype: int64
</code></pre>
<table>
<thead>
<tr>
<th>Label</th>
<th>Interval</th>
<th>Depth (Number of Instances)</th>
</tr>
</thead>
<tbody>
<tr>
<td>out.zero</td>
<td>(-0.001, 1.0]</td>
<td>423</td>
</tr>
<tr>
<td>out.extreme-low</td>
<td>(1.0, 3.0]</td>
<td>182</td>
</tr>
<tr>
<td>out.low</td>
<td>(3.0, 7.0]</td>
<td>307</td>
</tr>
<tr>
<td>out.medium</td>
<td>(7.0, 14.0]</td>
<td>292</td>
</tr>
<tr>
<td>out.high</td>
<td>(14.0, 116.0]</td>
<td>284</td>
</tr>
</tbody>
</table>
<h3 id="b-association-rule-mining">B. Association Rule Mining</h3>
<p>Using Apriori and FP-Growth algorithms, we want to discover the relationship between <code>in-flow counts</code> and <code>out-flow counts</code> of station <code>519</code>.</p>
<p>The support threshold and confidence threshold are determined by the quality and quantity of rules found.   That is, number of rules found should not be too small or too large and the rules found should have confidence as high as possible.</p>
<p>To compare the differences, I use the same support/confidence threshold to mine rules in transaction datasets with different discretization approach.</p>
<ul>
<li>First, we mine the association rules of the transaction dataset that is discretized with <strong><code>equi-sized</code> approach</strong>.
<ul>
<li>support threshold = 0.1</li>
<li>confidence threshold = 0.2</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">%%</span><span class="n">time</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Apriori</span><span class="se">\n</span><span class="s2">********&#34;</span><span class="p">)</span>
<span class="n">ap</span> <span class="o">=</span> <span class="n">apriori_find_association_rules</span><span class="p">(</span><span class="n">dat_1</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>Apriori
********
CPU times: user 1.88 ms, sys: 540 s, total: 2.42 ms
Wall time: 2.38 ms
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">apriori_show_mining_results</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>Rules:
------
(in.level-1) ==&gt; (out.level-1)  confidence = 0.998
(out.level-1) ==&gt; (in.level-1)  confidence = 0.957
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">%%</span><span class="n">time</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;FP-Growth</span><span class="se">\n</span><span class="s2">*********&#34;</span><span class="p">)</span>
<span class="n">fp</span> <span class="o">=</span> <span class="n">fp_find_association_rules</span><span class="p">(</span><span class="n">dat_1</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>FP-Growth
*********
CPU times: user 9.18 ms, sys: 958 s, total: 10.1 ms
Wall time: 9.31 ms
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">fp_show_mining_results</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">dat_1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>Rules:
------
(in.level-1) ==&gt; (out.level-1)  confidence = 0.998
(out.level-1) ==&gt; (in.level-1)  confidence = 0.957
</code></pre>
<ul>
<li>Next, we mine the association rules of the transaction dataset that is discretized with <strong><code>equi-depth</code> approach</strong>.
<ul>
<li>support threshold = 0.1</li>
<li>confidence threshold = 0.2</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">%%</span><span class="n">time</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Apriori</span><span class="se">\n</span><span class="s2">********&#34;</span><span class="p">)</span>
<span class="n">ap</span> <span class="o">=</span> <span class="n">apriori_find_association_rules</span><span class="p">(</span><span class="n">dat_2</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>Apriori
********
CPU times: user 3.49 ms, sys: 1.94 ms, total: 5.43 ms
Wall time: 4.91 ms
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">apriori_show_mining_results</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>Rules:
------
(in.high) ==&gt; (out.high)  confidence = 0.878
(out.high) ==&gt; (in.high)  confidence = 0.859
(in.medium) ==&gt; (out.medium)  confidence = 0.53
(out.medium) ==&gt; (in.medium)  confidence = 0.514
(in.zero) ==&gt; (out.zero)  confidence = 0.821
(out.zero) ==&gt; (in.zero)  confidence = 0.783
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">%%</span><span class="n">time</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;FP-Growth</span><span class="se">\n</span><span class="s2">*********&#34;</span><span class="p">)</span>
<span class="n">fp</span> <span class="o">=</span> <span class="n">fp_find_association_rules</span><span class="p">(</span><span class="n">dat_2</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>FP-Growth
*********
CPU times: user 9.77 ms, sys: 641 s, total: 10.4 ms
Wall time: 9.97 ms
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">fp_show_mining_results</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">dat_2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>Rules:
------
(in.high) ==&gt; (out.high)  confidence = 0.878
(out.high) ==&gt; (in.high)  confidence = 0.859
(in.medium) ==&gt; (out.medium)  confidence = 0.53
(out.medium) ==&gt; (in.medium)  confidence = 0.514
(in.zero) ==&gt; (out.zero)  confidence = 0.821
(out.zero) ==&gt; (in.zero)  confidence = 0.783
</code></pre>
<h3 id="c-observations">C. Observations</h3>
<p>The table below shows the rules found, sorted by their confidence.</p>
<table>
<thead>
<tr>
<th>Discretization Method</th>
<th>Rules Found</th>
<th>Confidence</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Method (1). <code>equi-sized</code></td>
<td>(in.level-1) &lt;==&gt; (out.level-1)</td>
<td>==&gt; 0.998; &lt;== 0.957</td>
<td></td>
</tr>
<tr>
<td>Method (2). <code>equi-depth</code></td>
<td>(in.high) &lt;==&gt; (out.high)</td>
<td>==&gt; 0.878; &lt;== 0.859</td>
<td></td>
</tr>
<tr>
<td>Method (2). <code>equi-depth</code></td>
<td>(in.zero) &lt;==&gt; (out.zero)</td>
<td>==&gt; 0.821; &lt;== 0.783</td>
<td></td>
</tr>
<tr>
<td>Method (2). <code>equi-depth</code></td>
<td>(in.medium) &lt;==&gt; (out.medium)</td>
<td>==&gt; 0.530; &lt;== 0.514</td>
<td></td>
</tr>
</tbody>
</table>
<p>Using <code>equi-sized</code> approach, we can find only <code>2</code> rules, which can be conclude as</p>
<ol>
<li>In every 30 minutes, in-flow count of <code>0~18</code> indicates out-flow count of <code>0~23</code>, and vice versa. (confidence &gt; 95%)</li>
</ol>
<p>Using <code>equi-depth</code> approach, we can find <code>6</code> rules, which can be conclude as</p>
<ol>
<li>In every 30 minutes, in-flow count of <code>15~91</code> indicates out-flow count of <code>15~116</code>, and vice versa. (confidence &gt; 85%)</li>
<li>In every 30 minutes, in-flow count of <code>0</code> indicates out-flow count of <code>0</code>, and vice versa. (confidence &gt; 78%)</li>
<li>In every 30 minutes, in-flow count of <code>8~14</code> indicates out-flow count of <code>8~14</code>, and vice versa. (confidence &gt; 50%)</li>
</ol>
<h3 id="d-comparisons">D. Comparisons</h3>
<p>Rules found by <code>equi-depth</code> approach cover all ranges of the flow count except the interval <code>1~7</code>.   <strong>With <code>equi-depth</code> approach, we can find much more rules.</strong>   I think it is because using <code>equi-sized</code> approach, number of instances in the buckets are <strong>too imbalance</strong> (e.g., there are only 2 instances that contains <code>level-5</code> in-flow count).</p>
<table>
<thead>
<tr>
<th>Top Rules</th>
<th>Discretization Method (1). <code>equi-sized</code> approach</th>
<th>Discretization Method (2). <code>equi-depth</code> approach</th>
</tr>
</thead>
<tbody>
<tr>
<td>confidence &gt; 90%</td>
<td>in-flow count of <code>0~18</code> &lt;==&gt; out-flow count of <code>0~23</code></td>
<td></td>
</tr>
<tr>
<td>confidence &gt; 80%</td>
<td></td>
<td>in-flow count of <code>15~91</code> &lt;==&gt; out-flow count of <code>15~116</code></td>
</tr>
<tr>
<td>confidence &gt; 70%</td>
<td></td>
<td>in-flow count of <code>0</code> &lt;==&gt; out-flow count of <code>0</code></td>
</tr>
<tr>
<td>confidence &gt; 60%</td>
<td></td>
<td></td>
</tr>
<tr>
<td>confidence &gt; 50%</td>
<td></td>
<td>in-flow count of <code>8~14</code> &lt;==&gt; out-flow count of <code>8~14</code></td>
</tr>
</tbody>
</table>
<p>However, the top 1 rule found by 2 discretization approach are actually very different. The top 1 rule found with <strong><code>equi-sized</code> approach</strong> says that <strong>low in-flow tends to co-occur with low out-flow</strong>, while and the top 1 rule found by <strong><code>equi-depth</code> approach</strong> says that <strong>high in-flow tends to co-occur with high out-flow</strong>.</p>
<br>
<br>
<table>
<thead>
<tr>
<th>Execution time (ms)</th>
<th>Discretization Method (1). <code>equi-sized</code> approach</th>
<th>Discretization Method (2). <code>equi-depth</code> approach</th>
</tr>
</thead>
<tbody>
<tr>
<td>Apriori</td>
<td>2.42</td>
<td>5.43</td>
</tr>
<tr>
<td>FP-Growth</td>
<td>10.1</td>
<td>10.4</td>
</tr>
</tbody>
</table>
<p>Surprisingly, FP-Growth runs much slower than Apriori in this case.   I think it is because that this transaction dataset is so small (only contains data from station <code>519</code>) that constructing FP-trees becomes a significant overhead in FP-Grwoth Algorithm.   Also, I think it is resonable that with <code>equi-depth</code> approach, which found more rules, cost more time in excution.</p>
<h2 id="task-2-find-rules-between-time-of-a-day-and-flows-of-station-519">Task 2: Find Rules between <code>Time of a Day</code> and <code>Flows</code> of station <code>519</code></h2>
<p>The second task is to find that if there is any association rules between the time of a day and the flow counts of station <code>519</code>.</p>
<p>For example,</p>
<p>$$
{Afternoon} \rightarrow {High~flow~count}
$$</p>
<h3 id="a-define-transactions-1">A. Define Transactions</h3>
<p>A transaction consists of</p>
<ul>
<li><code>time of a day</code></li>
<li><code>flow count</code> of station 519 (sum up in-flow count and out-flow count)</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">dat</span> <span class="o">=</span> <span class="n">df_flow</span><span class="p">[</span><span class="n">df_flow</span><span class="p">[</span><span class="s1">&#39;station id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">519</span><span class="p">][[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;in_flow_count&#39;</span><span class="p">,</span> <span class="s1">&#39;out_flow_count&#39;</span><span class="p">]]</span>
<span class="n">dat</span><span class="p">[</span><span class="s1">&#39;flow_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="s1">&#39;in_flow_count&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dat</span><span class="p">[</span><span class="s1">&#39;out_flow_count&#39;</span><span class="p">]</span>
<span class="n">dat</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;</span><span class="si">{:02d}</span><span class="s2">:</span><span class="si">{:02d}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">dt</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span> <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">dat</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]]</span>
<span class="n">dat</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;flow_count&#39;</span><span class="p">]]</span>
<span class="n">dat</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }
<pre><code>.dataframe thead th {
    text-align: left;
}

.dataframe tbody tr th {
    vertical-align: top;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>flow_count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>244329</th>
      <td>00:00</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>244330</th>
      <td>00:30</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>244331</th>
      <td>10:00</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>244332</th>
      <td>10:30</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>244333</th>
      <td>11:00</td>
      <td>11.0</td>
    </tr>
  </tbody>
</table>
</div>
<ul>
<li>
<p><strong>Discretization Method (1). Every 2 hours</strong></p>
<p>I split one day into <code>12</code> intervals (every 2 hours as a bucket).</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">dat_1</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">dat_1</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;</span><span class="si">{:02d}</span><span class="s2">:00~</span><span class="si">{:02d}</span><span class="s2">:00&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> \
                 <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">dat_1</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]]</span>
<span class="n">dat_1</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dat_1</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Note that I use the <code>equi-depth</code> approach to deal with the flow counts. (Intervals for <code>low</code>, <code>medium</code>, and <code>high</code> flow counts are shown as belows.)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">dat_1</span><span class="p">[</span><span class="s1">&#39;flow_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">dat_1</span><span class="p">[</span><span class="s1">&#39;flow_count&#39;</span><span class="p">],</span> <span class="n">q</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> \
                                <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;low&#34;</span><span class="p">,</span> <span class="s2">&#34;medium&#34;</span><span class="p">,</span> <span class="s2">&#34;high&#34;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

<span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;flow_count&#39;</span><span class="p">],</span> <span class="n">q</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>(-0.001, 5.0]    521
(17.0, 185.0]    486
(5.0, 17.0]      481
Name: flow_count, dtype: int64
</code></pre>
<ul>
<li>
<p><strong>Discretization Method (2). <code>Morning</code>, <code>Noon</code>, <code>Afternoon</code>, <code>Evening</code>, or <code>Night</code></strong></p>
<blockquote>
<ul>
<li>00:00 ~ 06:00: <code>Night</code></li>
<li>06:00 ~ 11:00: <code>Morning</code></li>
<li>11:00 ~ 13:00: <code>Noon</code></li>
<li>13:00 ~ 16:00: <code>Afternoon</code></li>
<li>16:00 ~ 22:00: <code>Evening</code></li>
<li>22:00 ~ 24:00: <code>Night</code></li>
</ul>
</blockquote>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">dat_2</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">mapping</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;Night&#34;</span><span class="p">]</span><span class="o">*</span><span class="mi">6</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&#34;Morning&#34;</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&#34;Noon&#34;</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&#34;Afternoon&#34;</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&#34;Evening&#34;</span><span class="p">]</span><span class="o">*</span><span class="mi">6</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&#34;Night&#34;</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
<span class="n">dat_2</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span><span class="p">)]</span> <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">dat_2</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]]</span>
</code></pre></td></tr></table>
</div>
</div><p>Note that I use the <code>equi-depth</code> approach again to deal with the in/out flow counts.    (Intervals for <code>low</code>, <code>medium</code>, and <code>high</code> flow counts are shown as belows.)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">dat_2</span><span class="p">[</span><span class="s1">&#39;flow_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">dat_2</span><span class="p">[</span><span class="s1">&#39;flow_count&#39;</span><span class="p">],</span> <span class="n">q</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> \
                                <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;low&#34;</span><span class="p">,</span> <span class="s2">&#34;medium&#34;</span><span class="p">,</span> <span class="s2">&#34;high&#34;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

<span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;flow_count&#39;</span><span class="p">],</span> <span class="n">q</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>(-0.001, 5.0]    521
(17.0, 185.0]    486
(5.0, 17.0]      481
Name: flow_count, dtype: int64
</code></pre>
<h3 id="b-association-rule-mining-1">B. Association Rule Mining</h3>
<p>Using Apriori and FP-Growth algorithms, we want to discover the relationship between <code>which time of a day</code> and <code>flow counts</code> of station <code>519</code>.</p>
<p>The support threshold and confidence threshold are determined by the quality and quantity of rules found.   That is, number of rules found should not be too small or too large and the rules found should have confidence as high as possible.</p>
<p>To compare the differences, I use the same support/confidence threshold to mine rules in transaction datasets with different discretization approach.</p>
<ul>
<li>First, we mine the association rules of the transaction dataset that is discretized with <strong><code>Every 2 hors</code> approach</strong>.
<ul>
<li>support threshold = 0.05</li>
<li>confidence threshold = 0.6</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">%%</span><span class="n">time</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Apriori</span><span class="se">\n</span><span class="s2">********&#34;</span><span class="p">)</span>
<span class="n">ap</span> <span class="o">=</span> <span class="n">apriori_find_association_rules</span><span class="p">(</span><span class="n">dat_1</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>Apriori
********
CPU times: user 3.14 ms, sys: 707 s, total: 3.85 ms
Wall time: 3.42 ms
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">apriori_show_mining_results</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>Rules:
------
(00:00~02:00) ==&gt; (low)  confidence = 0.903
(02:00~04:00) ==&gt; (low)  confidence = 0.992
(04:00~06:00) ==&gt; (low)  confidence = 0.855
(08:00~10:00) ==&gt; (high)  confidence = 0.637
(12:00~14:00) ==&gt; (medium)  confidence = 0.661
(16:00~18:00) ==&gt; (high)  confidence = 0.774
(18:00~20:00) ==&gt; (high)  confidence = 0.645
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">%%</span><span class="n">time</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;FP-Growth</span><span class="se">\n</span><span class="s2">*********&#34;</span><span class="p">)</span>
<span class="n">fp</span> <span class="o">=</span> <span class="n">fp_find_association_rules</span><span class="p">(</span><span class="n">dat_1</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>FP-Growth
*********
CPU times: user 9.18 ms, sys: 381 s, total: 9.56 ms
Wall time: 9.28 ms
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">fp_show_mining_results</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">dat_1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>Rules:
------
(00:00~02:00) ==&gt; (low)  confidence = 0.903
(12:00~14:00) ==&gt; (medium)  confidence = 0.661
(16:00~18:00) ==&gt; (high)  confidence = 0.774
(18:00~20:00) ==&gt; (high)  confidence = 0.645
(02:00~04:00) ==&gt; (low)  confidence = 0.992
(04:00~06:00) ==&gt; (low)  confidence = 0.855
(08:00~10:00) ==&gt; (high)  confidence = 0.637
</code></pre>
<ul>
<li>Next, we mine the association rules of the transaction dataset that is discretized with <strong><code>Morning/Afternon/...</code> approach</strong>.
<ul>
<li>support threshold = 0.05</li>
<li>confidence threshold = 0.6</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">%%</span><span class="n">time</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Apriori</span><span class="se">\n</span><span class="s2">********&#34;</span><span class="p">)</span>
<span class="n">ap</span> <span class="o">=</span> <span class="n">apriori_find_association_rules</span><span class="p">(</span><span class="n">dat_2</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>Apriori
********
CPU times: user 3.34 ms, sys: 1.33 ms, total: 4.67 ms
Wall time: 3.73 ms
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">apriori_show_mining_results</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>Rules:
------
(Night) ==&gt; (low)  confidence = 0.837
(low) ==&gt; (Night)  confidence = 0.797
(Noon) ==&gt; (medium)  confidence = 0.621
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">%%</span><span class="n">time</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;FP-Growth</span><span class="se">\n</span><span class="s2">*********&#34;</span><span class="p">)</span>
<span class="n">fp</span> <span class="o">=</span> <span class="n">fp_find_association_rules</span><span class="p">(</span><span class="n">dat_2</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>FP-Growth
*********
CPU times: user 9.44 ms, sys: 578 s, total: 10 ms
Wall time: 9.61 ms
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">fp_show_mining_results</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">dat_2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>Rules:
------
(Noon) ==&gt; (medium)  confidence = 0.621
(Night) ==&gt; (low)  confidence = 0.837
(low) ==&gt; (Night)  confidence = 0.797
</code></pre>
<h3 id="c-observations-1">C. Observations</h3>
<p>The table below shows the rules found, sorted by their confidence.</p>
<table>
<thead>
<tr>
<th>Discretization Method</th>
<th>Rules Found</th>
<th>Confidence</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Method (1). <code>Every 2 hours</code></td>
<td>(02:00~04:00) ==&gt; (low)</td>
<td>0.992</td>
<td></td>
</tr>
<tr>
<td>Method (1). <code>Every 2 hours</code></td>
<td>(00:00~02:00) ==&gt; (low)</td>
<td>0.903</td>
<td></td>
</tr>
<tr>
<td>Method (1). <code>Every 2 hours</code></td>
<td>(04:00~06:00) ==&gt; (low)</td>
<td>0.855</td>
<td></td>
</tr>
<tr>
<td>Method (2). <code>Morning/Afternon/...</code></td>
<td>(Night) ==&gt; (low)</td>
<td>0.837</td>
<td></td>
</tr>
<tr>
<td>Method (2). <code>Morning/Afternon/...</code></td>
<td>(low) ==&gt; (Night)</td>
<td>0.797</td>
<td></td>
</tr>
<tr>
<td>Method (1). <code>Every 2 hours</code></td>
<td>(16:00~18:00) ==&gt; (high)</td>
<td>0.774</td>
<td></td>
</tr>
<tr>
<td>Method (1). <code>Every 2 hours</code></td>
<td>(12:00~14:00) ==&gt; (medium)</td>
<td>0.661</td>
<td></td>
</tr>
<tr>
<td>Method (1). <code>Every 2 hours</code></td>
<td>(18:00~20:00) ==&gt; (high)</td>
<td>0.645</td>
<td></td>
</tr>
<tr>
<td>Method (1). <code>Every 2 hours</code></td>
<td>(08:00~10:00) ==&gt; (high)</td>
<td>0.637</td>
<td></td>
</tr>
<tr>
<td>Method (2). <code>Morning/Afternon/...</code></td>
<td>(Noon) ==&gt; (medium)</td>
<td>0.621</td>
<td></td>
</tr>
</tbody>
</table>
<p>Using &ldquo;<code>Every 2 hours</code>&rdquo; approach, we can find <code>7</code> rules, which can be conclude as</p>
<ol>
<li>At <code>00 ~ 06</code> o&rsquo;clock, the flow counts tend to be <code>lower than 5</code> in every half hour. (confidence &gt; 85%)</li>
<li>At <code>12 ~ 14</code> o&rsquo;clock, the flow counts tend to be in the interval <code>(5, 17]</code> in every half hour. (confidence &gt; 65%)</li>
<li>At <code>16 ~ 20</code> o&rsquo;clock, the flow counts tend to be <code>more than 17</code> in every half hour (confidence &gt; 64%), especially at <code>16 ~ 18</code> o&rsquo;clock (confidence &gt; 75%).</li>
<li>At <code>08 ~ 10</code> o&rsquo;clock, the flow counts tend to be in the interval <code>more than 17</code> in every half hour. (confidence &gt; 60%)</li>
</ol>
<p>Using &ldquo;<code>Morning/Afternon/...</code>&rdquo; approach, we can find <code>3</code> rules, which can be conclude as</p>
<ol>
<li>At night (<code>22 ~ 24</code> and <code>00 ~ 06</code> o&rsquo;clock), the flow counts tend to be <code>lower than 5</code> in every half hour, and vice versa. (confidence &gt; 79%)</li>
<li>At noon (<code>11 ~ 13</code> o&rsquo;clock),  the flow counts tend to be in the interval <code>(5, 17]</code> in every half hour. (confidence &gt; 60%)</li>
</ol>
<h3 id="d-comparisons-1">D. Comparisons</h3>
<p>With &ldquo;<code>Every 2 hours</code>&rdquo; approach, we can find more rules.  I think it is becuase with this approach, we&rsquo;ve got more buckets and it happens to match the scenario that flow counts change rapidly at the scale of hour.</p>
<table>
<thead>
<tr>
<th>Top Rules</th>
<th>Discretization Method (1). &ldquo;<code>Every 2 hours</code>&rdquo; approach</th>
<th>Discretization Method (2). &ldquo;<code>Morning/Afternon/...</code>&rdquo; approach</th>
</tr>
</thead>
<tbody>
<tr>
<td>confidence &gt; 90%</td>
<td>(02:00~04:00) ==&gt; <code>less than 5</code> flow counts per 30 minutes<br>(00:00~02:00) ==&gt; <code>less than 5</code> flow counts per 30 minutes</td>
<td></td>
</tr>
<tr>
<td>confidence &gt; 80%</td>
<td>(04:00~06:00) ==&gt; <code>less than 5</code> flow counts per 30 minutes</td>
<td>(Night) ==&gt; <code>less than 5</code> flow counts per 30 minutes</td>
</tr>
<tr>
<td>confidence &gt; 70%</td>
<td>(16:00~18:00) ==&gt; <code>more than 17</code> flow counts per 30 minutes</td>
<td><code>less than 5</code> flow counts per 30 minutes ==&gt; (Night)</td>
</tr>
<tr>
<td>confidence &gt; 60%</td>
<td>(12:00~14:00) ==&gt; <code>5 ~ 17</code> flow counts per 30 minutes<br>(18:00~20:00) ==&gt; <code>more than 17</code> flow counts per 30 minutes<br>(08:00~10:00) ==&gt; <code>more than 17</code> flow counts per 30 minutes</td>
<td>(Noon) ==&gt; <code>5 ~ 17</code> flow counts per 30 minutes</td>
</tr>
</tbody>
</table>
<p>If you check the rules carefully, you would find that the rules found by Method (1) almost cover the rules found by Method (2).   However, we would say that the rules found by Method (2) is more instinctive at first sight.</p>
<br>
<br>
<table>
<thead>
<tr>
<th>Execution time (ms)</th>
<th>Discretization Method (1). &ldquo;<code>Every 2 hours</code>&rdquo; approach</th>
<th>Discretization Method (2). &ldquo;<code>Morning/Afternon/...</code>&rdquo; approach</th>
</tr>
</thead>
<tbody>
<tr>
<td>Apriori</td>
<td>3.85</td>
<td>4.67</td>
</tr>
<tr>
<td>FP-Growth</td>
<td>9.56</td>
<td>10.0</td>
</tr>
</tbody>
</table>
<p>FP-Growth runs much slower than Apriori in this case.   I think it is again because that this transaction dataset is so small (only contains data from station <code>519</code>) that constructing FP-trees becomes a significant overhead in FP-Grwoth Algorithm.</p>
<h2 id="task-3-find-rules-between-station-locations-and-their--daily-flows">Task 3: Find Rules between <code>Station Locations</code> and Their  <code>Daily Flows</code></h2>
<p>The third task is to find if there is any association rules between the location of a station and its daily flow counts.</p>
<p>For example,</p>
<p>$$
{40 &lt; longitude \leq 40.5 } \rightarrow {High~daily~flow~count}
$$</p>
<h3 id="a-define-transactions-2">A. Define Transactions</h3>
<p>A transaction consists of</p>
<ul>
<li><code>station latitude</code></li>
<li><code>station longitude</code></li>
<li><code>daily flow counts</code> (sum up everyday in-flow count and out-flow count)</li>
</ul>
<p>Note that I use <em>daily flow count</em> instead of <em>flow count in every half hour</em> to avoid generating only rules about zero or low flow count.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">dat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_flow</span><span class="p">,</span> <span class="n">df_loc</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;station id&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="n">dat</span><span class="p">[</span><span class="s1">&#39;flow_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="s1">&#39;in_flow_count&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dat</span><span class="p">[</span><span class="s1">&#39;out_flow_count&#39;</span><span class="p">]</span>
<span class="n">dat</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span> <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">dat</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]]</span>
<span class="n">dat</span> <span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;station latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;station longitude&#39;</span><span class="p">,</span> <span class="s2">&#34;day&#34;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> \
            <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;flow_count&#39;</span><span class="p">:</span> <span class="s1">&#39;sum&#39;</span><span class="p">})</span>
<span class="n">dat</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[[</span><span class="s1">&#39;station latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;station longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;flow_count&#39;</span><span class="p">]]</span>
<span class="n">dat</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }
<pre><code>.dataframe thead th {
    text-align: left;
}

.dataframe tbody tr th {
    vertical-align: top;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>station latitude</th>
      <th>station longitude</th>
      <th>flow_count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>40.6554</td>
      <td>-74.010628</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>40.6554</td>
      <td>-74.010628</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>40.6554</td>
      <td>-74.010628</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>40.6554</td>
      <td>-74.010628</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>40.6554</td>
      <td>-74.010628</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
<ul>
<li>
<p><strong>Discretization Method (1). <code>equi-sized</code> approach</strong></p>
<p>With <code>equi-sized</code> approach, I partition the continuous domain into intervals with equal length.</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;station latitude&#39;</span><span class="p">],</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>(40.715, 40.745]    5425
(40.685, 40.715]    4805
(40.745, 40.774]    3968
(40.655, 40.685]    2945
(40.774, 40.804]    2480
Name: station latitude, dtype: int64
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;station longitude&#39;</span><span class="p">],</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>(-74.012, -73.985]    7626
(-73.985, -73.957]    7347
(-73.957, -73.93]     3875
(-74.04, -74.012]      651
(-74.067, -74.04]      124
Name: station longitude, dtype: int64
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">dat_1</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">dat_1</span><span class="p">[</span><span class="s1">&#39;station latitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">dat_1</span><span class="p">[</span><span class="s1">&#39;station latitude&#39;</span><span class="p">],</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">dat_1</span><span class="p">[</span><span class="s1">&#39;station latitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;latitude = &#34;</span> <span class="o">+</span> <span class="n">dat_1</span><span class="p">[</span><span class="s1">&#39;station latitude&#39;</span><span class="p">]</span>
<span class="n">dat_1</span><span class="p">[</span><span class="s1">&#39;station longitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">dat_1</span><span class="p">[</span><span class="s1">&#39;station longitude&#39;</span><span class="p">],</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">dat_1</span><span class="p">[</span><span class="s1">&#39;station longitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;longitude = &#34;</span><span class="o">+</span> <span class="n">dat_1</span><span class="p">[</span><span class="s1">&#39;station longitude&#39;</span><span class="p">]</span> 
</code></pre></td></tr></table>
</div>
</div><p>Note that I use the <code>equi-depth</code> approach to deal with the flow counts.    (Intervals for <code>extreme-low</code>, <code>low</code>, <code>medium</code>, <code>high</code>, and <code>extreme-high</code> flow counts are shown as belows.)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">dat_1</span><span class="p">[</span><span class="s1">&#39;flow_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">dat_1</span><span class="p">[</span><span class="s1">&#39;flow_count&#39;</span><span class="p">],</span> <span class="n">q</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> \
                             <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;extreme-low&#34;</span><span class="p">,</span> <span class="s2">&#34;low&#34;</span><span class="p">,</span> <span class="s2">&#34;medium&#34;</span><span class="p">,</span> <span class="s2">&#34;high&#34;</span><span class="p">,</span> <span class="s2">&#34;extreme-high&#34;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;flow_count&#39;</span><span class="p">],</span> <span class="n">q</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>(-0.001, 51.0]     3943
(51.0, 96.0]       3939
(163.0, 286.0]     3923
(286.0, 1532.0]    3919
(96.0, 163.0]      3899
Name: flow_count, dtype: int64
</code></pre>
<ul>
<li>
<p><strong>Discretization Method (2). <code>equi-depth</code> approach</strong></p>
<p>With <code>equi-depth</code> approach, I partition the data values into intervals with equal size along the ordering of the data.</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;station latitude&#39;</span><span class="p">],</span> <span class="n">q</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>(40.735, 40.762]    3937
(40.691, 40.715]    3937
(40.654, 40.691]    3937
(40.762, 40.804]    3906
(40.715, 40.735]    3906
Name: station latitude, dtype: int64
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;station longitude&#39;</span><span class="p">],</span> <span class="n">q</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>(-73.976, -73.957]    3937
(-73.998, -73.987]    3937
(-74.068, -73.998]    3937
(-73.957, -73.93]     3906
(-73.987, -73.976]    3906
Name: station longitude, dtype: int64
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">dat_2</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">dat_2</span><span class="p">[</span><span class="s1">&#39;station latitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">dat_2</span><span class="p">[</span><span class="s1">&#39;station latitude&#39;</span><span class="p">],</span> <span class="n">q</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">dat_2</span><span class="p">[</span><span class="s1">&#39;station latitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;latitude = &#34;</span> <span class="o">+</span> <span class="n">dat_2</span><span class="p">[</span><span class="s1">&#39;station latitude&#39;</span><span class="p">]</span>
<span class="n">dat_2</span><span class="p">[</span><span class="s1">&#39;station longitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">dat_2</span><span class="p">[</span><span class="s1">&#39;station longitude&#39;</span><span class="p">],</span> <span class="n">q</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">dat_2</span><span class="p">[</span><span class="s1">&#39;station longitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;longitude = &#34;</span><span class="o">+</span> <span class="n">dat_2</span><span class="p">[</span><span class="s1">&#39;station longitude&#39;</span><span class="p">]</span> 
</code></pre></td></tr></table>
</div>
</div><p>Note that I use the <code>equi-depth</code> approach again to deal with the flow counts.        (Intervals for <code>extreme-low</code>, <code>low</code>, <code>medium</code>, <code>high</code>, and <code>extreme-high</code> flow counts are shown as belows.)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">dat_2</span><span class="p">[</span><span class="s1">&#39;flow_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">dat_2</span><span class="p">[</span><span class="s1">&#39;flow_count&#39;</span><span class="p">],</span> <span class="n">q</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> \
                             <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;extreme-low&#34;</span><span class="p">,</span> <span class="s2">&#34;low&#34;</span><span class="p">,</span> <span class="s2">&#34;medium&#34;</span><span class="p">,</span> <span class="s2">&#34;high&#34;</span><span class="p">,</span> <span class="s2">&#34;extreme-high&#34;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;flow_count&#39;</span><span class="p">],</span> <span class="n">q</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>(-0.001, 51.0]     3943
(51.0, 96.0]       3939
(163.0, 286.0]     3923
(286.0, 1532.0]    3919
(96.0, 163.0]      3899
Name: flow_count, dtype: int64
</code></pre>
<h3 id="b-association-rule-mining-2">B. Association Rule Mining</h3>
<p>Using Apriori and FP-Growth algorithms, we want to discover the relationship between <code>station locations</code> and their <code>daily flow counts</code>.</p>
<p>The support threshold and confidence threshold are determined by the quality and quantity of rules found.   That is, number of rules found should not be too small or too large and the rules found should have confidence as high as possible.</p>
<p>To compare the differences, I use the same support/confidence threshold to mine rules in transaction datasets with different discretization approach.</p>
<ul>
<li>First, we mine the association rules of the transaction dataset that is discretized with <strong><code>equi-sized</code> approach</strong>.
<ul>
<li>support threshold = 0.08</li>
<li>confidence threshold = 0.4</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">%%</span><span class="n">time</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Apriori</span><span class="se">\n</span><span class="s2">********&#34;</span><span class="p">)</span>
<span class="n">ap</span> <span class="o">=</span> <span class="n">apriori_find_association_rules</span><span class="p">(</span><span class="n">dat_1</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>Apriori
********
CPU times: user 30.2 ms, sys: 2.86 ms, total: 33 ms
Wall time: 30.7 ms
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">apriori_show_mining_results</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>Rules:
------
(extreme-high) ==&gt; (latitude = (40.715, 40.745])  confidence = 0.529
(extreme-high) ==&gt; (longitude = (-74.012, -73.985])  confidence = 0.64
(high) ==&gt; (longitude = (-74.012, -73.985])  confidence = 0.526
(latitude = (40.715, 40.745]) ==&gt; (longitude = (-74.012, -73.985])  confidence = 0.514
(latitude = (40.745, 40.774]) ==&gt; (longitude = (-73.985, -73.957])  confidence = 0.492
(low) ==&gt; (longitude = (-73.985, -73.957])  confidence = 0.469
(medium) ==&gt; (longitude = (-73.985, -73.957])  confidence = 0.488
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">%%</span><span class="n">time</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;FP-Growth</span><span class="se">\n</span><span class="s2">*********&#34;</span><span class="p">)</span>
<span class="n">fp</span> <span class="o">=</span> <span class="n">fp_find_association_rules</span><span class="p">(</span><span class="n">dat_1</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>FP-Growth
*********
CPU times: user 166 ms, sys: 2.63 ms, total: 169 ms
Wall time: 168 ms
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">fp_show_mining_results</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">dat_1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>Rules:
------
(medium) ==&gt; (longitude = (-73.985, -73.957])  confidence = 0.488
(high) ==&gt; (longitude = (-74.012, -73.985])  confidence = 0.526
(low) ==&gt; (longitude = (-73.985, -73.957])  confidence = 0.469
(latitude = (40.745, 40.774]) ==&gt; (longitude = (-73.985, -73.957])  confidence = 0.492
(latitude = (40.715, 40.745]) ==&gt; (longitude = (-74.012, -73.985])  confidence = 0.514
</code></pre>
<ul>
<li>Next, we mine the association rules of the transaction dataset that is discretized with <strong><code>equi-depth</code> approach</strong>.
<ul>
<li>support threshold = 0.08</li>
<li>confidence threshold = 0.4</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">%%</span><span class="n">time</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Apriori</span><span class="se">\n</span><span class="s2">********&#34;</span><span class="p">)</span>
<span class="n">ap</span> <span class="o">=</span> <span class="n">apriori_find_association_rules</span><span class="p">(</span><span class="n">dat_2</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>Apriori
********
CPU times: user 29.9 ms, sys: 1.09 ms, total: 31 ms
Wall time: 30.4 ms
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">apriori_show_mining_results</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>Rules:
------
(extreme-high) ==&gt; (latitude = (40.735, 40.762])  confidence = 0.451
(latitude = (40.735, 40.762]) ==&gt; (extreme-high)  confidence = 0.449
(extreme-low) ==&gt; (latitude = (40.654, 40.691])  confidence = 0.403
(latitude = (40.654, 40.691]) ==&gt; (extreme-low)  confidence = 0.404
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">%%</span><span class="n">time</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;FP-Growth</span><span class="se">\n</span><span class="s2">*********&#34;</span><span class="p">)</span>
<span class="n">fp</span> <span class="o">=</span> <span class="n">fp_find_association_rules</span><span class="p">(</span><span class="n">dat_2</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>FP-Growth
*********
CPU times: user 159 ms, sys: 2.69 ms, total: 162 ms
Wall time: 162 ms
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">fp_show_mining_results</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">dat_2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>Rules:
------
(extreme-high) ==&gt; (latitude = (40.735, 40.762])  confidence = 0.451
(latitude = (40.735, 40.762]) ==&gt; (extreme-high)  confidence = 0.449
(extreme-low) ==&gt; (latitude = (40.654, 40.691])  confidence = 0.403
(latitude = (40.654, 40.691]) ==&gt; (extreme-low)  confidence = 0.404
</code></pre>
<p>It is strange that number of rules found by Apriori is greater than number of rules found by FP-Growth using the transaction dataset discretized by <code>equi-sized</code> approach.   I later confirm that the rules found by Apriori are all correct.   Hence <strong>in the following discussion, I am going to use the mining result of Apriori</strong>.</p>
<p>So why did this implementation of FP-Growth found less rules?</p>
<p>Check out the frequent itemset found by FP-Growth, I found that this implementation of FP-growth missed some 1-frequent itemsets.   For example, it showed that itemset <code>('extreme-high', 'latitude = (40.715, 40.745]')</code> is frequent, but it didn&rsquo;t show that itemset <code>('extreme-high')</code> is frequent while showing that itemset <code>('latitude = (40.715, 40.745]')</code> is frequent.</p>
<p>This is the reason why using this implementation of FP-Growth cannot find rule <code>(extreme-high) ==&gt; (latitude = (40.715, 40.745])</code></p>
<h3 id="c-observations-2">C. Observations</h3>
<p>Note the following function <code>show_discretization_result()</code> is defined in the <a href="#Appendix">appendix</a>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">show_discretization_result</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="https://i.imgur.com/fpKkpDk.png" alt=""></p>
<p>The table below shows the rules found, sorted by their confidence.</p>
<table>
<thead>
<tr>
<th>Discretization Method</th>
<th>Rules Found</th>
<th>Confidence</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Method (1). <code>equi-sized</code></td>
<td>(extreme-high) ==&gt; (longitude = (-74.012, -73.985])</td>
<td>0.640</td>
<td></td>
</tr>
<tr>
<td>Method (1). <code>equi-sized</code></td>
<td>(extreme-high) ==&gt; (latitude = (40.715, 40.745])</td>
<td>0.529</td>
<td></td>
</tr>
<tr>
<td>Method (1). <code>equi-sized</code></td>
<td>(high) ==&gt; (longitude = (-74.012, -73.985])</td>
<td>0.526</td>
<td></td>
</tr>
<tr>
<td>Method (1). <code>equi-sized</code></td>
<td>(latitude = (40.715, 40.745]) ==&gt; (longitude = (-74.012, -73.985])</td>
<td>0.514</td>
<td></td>
</tr>
<tr>
<td>Method (1). <code>equi-sized</code></td>
<td>(latitude = (40.745, 40.774]) ==&gt; (longitude = (-73.985, -73.957])</td>
<td>0.492</td>
<td></td>
</tr>
<tr>
<td>Method (1). <code>equi-sized</code></td>
<td>(medium) ==&gt; (longitude = (-73.985, -73.957])</td>
<td>0.488</td>
<td></td>
</tr>
<tr>
<td>Method (1). <code>equi-sized</code></td>
<td>(low) ==&gt; (longitude = (-73.985, -73.957])</td>
<td>0.469</td>
<td></td>
</tr>
<tr>
<td>Method (2). <code>equi-depth</code></td>
<td>(latitude = (40.736, 40.762]) &lt;==&gt; (extreme-high)</td>
<td>==&gt; 0.451; &lt;== 0.449</td>
<td></td>
</tr>
<tr>
<td>Method (2). <code>equi-depth</code></td>
<td>(latitude = (40.654, 40.691]) &lt;==&gt; (extreme-low)</td>
<td>==&gt; 0.404; &lt;== 0.403</td>
<td></td>
</tr>
</tbody>
</table>
<p>Using <code>equi-sized</code> approach, we can find <code>7</code> rules, which can be conclude as</p>
<ol>
<li><code>Extreme-high</code> daily flow count ( <code>more than 286</code> per day) tend to occur at the area of latitude <code>40.715 ~ 40.745</code> and longitude <code>-74.012 ~ -73.985</code>. (confidence &gt;52%)</li>
<li><code>High</code> daily flow counts (<code>164 ~ 286</code> per day) tend to occur at the area of latitude <code>40.715 ~ 40.745</code>. (confidence &gt;50%)</li>
<li>Stations at latitude <code>40.715 ~ 40.745</code> tend to locate at longitude <code>-74.012 ~ -73.985</code>. (confidence &gt;50%)</li>
<li>Stations at latitude <code>40.745 ~ 40.774</code> tend to locate at longitude <code>-73.985 ~ -73.957</code>. (confidence $\simeq$50%)</li>
<li><code>Medium</code> and <code>low</code> daily flow counts (<code>52 ~ 163</code> per day) tend to occur at the area of longitude <code>-73.985 ~ -73.957</code>. (confidence $\simeq$50%)</li>
</ol>
<p>Using <code>equi-depth</code> approach, we can find <code>4</code> rules, which can be conclude as</p>
<ol>
<li>Stations at latitude <code>40.736 ~ 40.762</code> tend to have <code>extreme-high</code> daily flow count ( <code>more than 286</code> per day). (confidence $\simeq$45%)</li>
<li>Stations at latitude <code>40.654 ~ 40.691</code> tend to have <code>extreme-low</code> daily flow count ( <code>more than 286</code> per day). (confidence &gt;40%)</li>
</ol>
<p>In general, stations at latitude <code>40.715 ~ 40.762</code>(<em>Manhattan</em> &amp; <em>Long Island City, Brooklyn</em>) tend to have <code>high</code> to <code>extreme-high</code> daily flow counts, while stations at latitude <code>40.715 ~ 40.762</code>(<em>Williamsburg, Brooklyn &amp; Red Hook, Brooklyn</em>) tend to have <code>low</code> to <code>extreme-low</code> daily flow counts.</p>
<h3 id="d-comparisons-2">D. Comparisons</h3>
<table>
<thead>
<tr>
<th>Top Rules</th>
<th>Discretization Method (1). <code>equi-sized</code> approach</th>
<th>Discretization Method (2). <code>equi-depth</code> approach</th>
</tr>
</thead>
<tbody>
<tr>
<td>confidence &gt; 60%</td>
<td><code>more than 286</code> flow counts per day ==&gt; (longitude = (-74.012, -73.985])</td>
<td></td>
</tr>
<tr>
<td>confidence &gt; 55%</td>
<td></td>
<td></td>
</tr>
<tr>
<td>confidence &gt; 50%</td>
<td><code>more than 286</code> flow counts per day ==&gt; (latitude = (40.715, 40.745])<br><code>164 ~ 286</code> flow counts per day ==&gt; (longitude = (-74.012, -73.985])<br>(latitude = (40.715, 40.745]) ==&gt; (longitude = (-74.012, -73.985])</td>
<td></td>
</tr>
<tr>
<td>confidence &gt; 45%</td>
<td>(latitude = (40.745, 40.774]) ==&gt; (longitude = (-73.985, -73.957])<br><code>97 ~ 163</code> flow counts per day ==&gt; (longitude = (-73.985, -73.957])<br><code>52 ~ 96</code> flow counts per day ==&gt; (longitude = (-73.985, -73.957])</td>
<td>(latitude = (40.736, 40.762]) ==&gt; <code>more than 286</code> flow counts per day</td>
</tr>
<tr>
<td>confidence &gt; 40%</td>
<td></td>
<td>(latitude = (40.736, 40.762]) &lt;== <code>more than 286</code> flow counts per day<br>(latitude = (40.654, 40.691]) &lt;==&gt; <code>less than 52</code> flow counts per day</td>
</tr>
</tbody>
</table>
<p><strong>With <code>equi-sized</code> approach, we can find more rules and higher confidence.</strong>   I think it is because using <code>equi-depth</code> approach would make all splitted areas have the same density of stations, while a station is actually built according to the population or say, estimated flow count, of that area.   As the result, the number of rules mined with <code>equi-depth</code> approach and their confidence would likely to be low.</p>
<br>
<br>
<table>
<thead>
<tr>
<th>Execution time (ms)</th>
<th>Discretization Method (1). <code>equi-sized</code> approach</th>
<th>Discretization Method (2). <code>equi-depth</code> approach</th>
</tr>
</thead>
<tbody>
<tr>
<td>Apriori</td>
<td>33</td>
<td>31</td>
</tr>
<tr>
<td>FP-Growth</td>
<td>169</td>
<td>162</td>
</tr>
</tbody>
</table>
<p>Surprisingly, FP-Growth still runs much slower than Apriori in this case.   This time we have much bigger transaction dataset, however, the execution time of FP-Growth is still much larger.   In my opinion, the reason may be that this implementation of FP-Growth is not so well-written to be efficient.</p>
<h2 id="appendix">Appendix</h2>
<p>The functions for <code>show_discretization_result()</code> used in <strong>section C of Task 3</strong> are defined here.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">plot_stations_map</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">stns</span><span class="p">,</span> <span class="n">parallels_val</span><span class="p">,</span> <span class="n">meridians_val</span><span class="p">):</span>
    <span class="c1"># determine range to print based on min, max lat and lon of the data</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">stns</span><span class="p">[</span><span class="s1">&#39;station latitude&#39;</span><span class="p">])</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">stns</span><span class="p">[</span><span class="s1">&#39;station longitude&#39;</span><span class="p">])</span>
    <span class="n">siz</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">stns</span><span class="p">[</span><span class="s1">&#39;flow_count&#39;</span><span class="p">]]</span>
    <span class="n">margin</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="c1"># buffer to add to the range</span>
    <span class="n">lat_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="o">-</span> <span class="n">margin</span>
    <span class="n">lat_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="o">+</span> <span class="n">margin</span>
    <span class="n">lon_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span> <span class="o">-</span> <span class="n">margin</span>
    <span class="n">lon_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span> <span class="o">+</span> <span class="n">margin</span>

    <span class="c1"># create map using BASEMAP</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span><span class="n">llcrnrlon</span><span class="o">=</span><span class="n">lon_min</span><span class="p">,</span>
                <span class="n">llcrnrlat</span><span class="o">=</span><span class="n">lat_min</span><span class="p">,</span>
                <span class="n">urcrnrlon</span><span class="o">=</span><span class="n">lon_max</span><span class="p">,</span>
                <span class="n">urcrnrlat</span><span class="o">=</span><span class="n">lat_max</span><span class="p">,</span>
                <span class="n">lat_0</span><span class="o">=</span><span class="p">(</span><span class="n">lat_max</span> <span class="o">-</span> <span class="n">lat_min</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">lon_0</span><span class="o">=</span><span class="p">(</span><span class="n">lon_max</span> <span class="o">-</span> <span class="n">lon_min</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;lcc&#39;</span><span class="p">,</span>
                <span class="n">resolution</span> <span class="o">=</span> <span class="s1">&#39;f&#39;</span><span class="p">,)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">drawcoastlines</span><span class="p">()</span>
    <span class="n">m</span><span class="o">.</span><span class="n">fillcontinents</span><span class="p">(</span><span class="n">lake_color</span><span class="o">=</span><span class="s1">&#39;aqua&#39;</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">drawmapboundary</span><span class="p">(</span><span class="n">fill_color</span><span class="o">=</span><span class="s1">&#39;aqua&#39;</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">drawrivers</span><span class="p">()</span>
    
    <span class="n">m</span><span class="o">.</span><span class="n">drawparallels</span><span class="p">(</span><span class="n">parallels_val</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="kc">False</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">])</span>
    <span class="n">meridians</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">drawmeridians</span><span class="p">(</span><span class="n">meridians_val</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="kc">True</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">meridians</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">meridians</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="c1"># convert lat and lon to map projection coordinates</span>
    <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>

    <span class="c1"># plot points as red dots</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">show_discretization_result</span><span class="p">():</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&#34;Equi-Sized&#34;</span><span class="p">)</span>
    <span class="n">parallels_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">40.655</span><span class="p">,</span> <span class="mf">40.685</span><span class="p">,</span> <span class="mf">40.715</span><span class="p">,</span> <span class="mf">40.745</span><span class="p">,</span> <span class="mf">40.774</span><span class="p">,</span> <span class="mf">40.804</span><span class="p">])</span>
    <span class="n">meridians_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">73.93</span><span class="p">,</span> <span class="o">-</span><span class="mf">73.957</span><span class="p">,</span> <span class="o">-</span><span class="mf">73.985</span><span class="p">,</span> <span class="o">-</span><span class="mf">74.012</span><span class="p">,</span> <span class="o">-</span><span class="mf">74.04</span><span class="p">,</span> <span class="o">-</span><span class="mf">74.067</span><span class="p">])</span>
    <span class="n">plot_stations_map</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">dat</span><span class="p">,</span> <span class="n">parallels_val</span><span class="p">,</span> <span class="n">meridians_val</span><span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&#34;Equi-Depth&#34;</span><span class="p">)</span>
    <span class="n">parallels_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">40.655</span><span class="p">,</span> <span class="mf">40.691</span><span class="p">,</span> <span class="mf">40.715</span><span class="p">,</span> <span class="mf">40.735</span><span class="p">,</span> <span class="mf">40.762</span><span class="p">,</span> <span class="mf">40.804</span><span class="p">])</span>
    <span class="n">meridians_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">73.93</span><span class="p">,</span> <span class="o">-</span><span class="mf">73.957</span><span class="p">,</span> <span class="o">-</span><span class="mf">73.976</span><span class="p">,</span> <span class="o">-</span><span class="mf">73.987</span><span class="p">,</span> <span class="o">-</span><span class="mf">73.998</span><span class="p">,</span> <span class="o">-</span><span class="mf">74.068</span><span class="p">])</span>
    <span class="n">plot_stations_map</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">dat</span><span class="p">,</span> <span class="n">parallels_val</span><span class="p">,</span> <span class="n">meridians_val</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div>
    
	</div>
  <footer class="article-footer clearfix">
  

<div class="article-tags">
  <span></span>
  
  <a href="https://binnz.github.io/tags/data-mining">Data-Mining</a>
  
  <a href="https://binnz.github.io/tags/python">Python</a>
  
  <a href="https://binnz.github.io/tags/association-analysis">Association-Analysis</a>
  
</div>





<div class="article-categories">
  <span></span>
  
  <a class="article-category-link" href="https://binnz.github.io/categories/programming">Programming</a>
  
</div>



  <div class="article-share" id="share">
    <div data-url="https://binnz.github.io/post/2018-01-01-association-rule-mining/" data-title="Mining Association Rules on New York City Bike Dataset" data-tsina="" class="share clearfix">
    </div>
  </div>
</footer>

	</article>
  


<section class="comment">
<div id="disqus_thread"></div>
</section>
<script>
  <!-- detect whether Disuqs can load -->
  var xhr = new XMLHttpRequest();
  xhr.open('GET', '//disqus.com/next/config.json?' + new Date().getTime(), true);
  xhr.timeout = 3000; 

  xhr.onload = function() { 


var disqus_config = function () {
this.page.url = "https://binnz.github.io/post/2018-01-01-association-rule-mining/";
this.page.identifier = "https://binnz.github.io/post/2018-01-01-association-rule-mining/";
};
(function() { 
var d = document, s = d.createElement('script');

s.src = '//disc.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
}
  xhr.ontimeout = function() {
  <!-- cannot load Disqus, skip it. -->
  return;
}
xhr.send(null);
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


</div>

    <div class="openaside"><a class="navbutton" href="#" title="Show SideBar"></a></div>
<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide SideBar"></a></div>
<aside class="clearfix">
  

<div class="categorieslist">
  <p class="asidetitle">Categories</p>
  <ul>
    
    <li><a href="https://binnz.github.io/categories/install" title="install">install<sup>2</sup></a></li>
    
    <li><a href="https://binnz.github.io/categories/life" title="life">life<sup>1</sup></a></li>
    
    <li><a href="https://binnz.github.io/categories/notes" title="notes">notes<sup>50</sup></a></li>
    
    <li><a href="https://binnz.github.io/categories/programming" title="programming">programming<sup>25</sup></a></li>
    
    <li><a href="https://binnz.github.io/categories/projects" title="projects">projects<sup>2</sup></a></li>
    
    <li><a href="https://binnz.github.io/categories/publications" title="publications">publications<sup>1</sup></a></li>
    
  </ul>
</div>



  

<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
      
			<li><a href="https://binnz.github.io/tags/ANDROID" title="android">android<sup>1</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/APACHE-PIG" title="apache-pig">apache-pig<sup>1</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/ASSOCIATION-ANALYSIS" title="association-analysis">association-analysis<sup>9</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/BEER" title="beer">beer<sup>1</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/CLASSIFICATION" title="classification">classification<sup>9</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/CLUSTERING" title="clustering">clustering<sup>19</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/CONFERENCE" title="conference">conference<sup>1</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/DATA-MINING" title="data-mining">data-mining<sup>64</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/DATA-SCIENCE" title="data-science">data-science<sup>1</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/DATABASE" title="database">database<sup>1</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/DEEP-LEARNING" title="deep-learning">deep-learning<sup>2</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/ELASTICSEARCH" title="elasticsearch">elasticsearch<sup>2</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/GRAPH" title="graph">graph<sup>12</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/HADOOP" title="hadoop">hadoop<sup>1</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/INFORMATION-RETRIEVAL" title="information-retrieval">information-retrieval<sup>1</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/JAVA" title="java">java<sup>5</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/MACHINE-LEARNING" title="machine-learning">machine-learning<sup>5</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/NEURAL-NETWORK" title="neural-network">neural-network<sup>2</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/NLP" title="nlp">nlp<sup>4</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/NLTK" title="nltk">nltk<sup>1</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/PYTHON" title="python">python<sup>15</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/R" title="r">r<sup>4</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/RELATION-ALGEBRA" title="relation-algebra">relation-algebra<sup>1</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/SCIKIT-LEARN" title="scikit-learn">scikit-learn<sup>5</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/SPARK" title="spark">spark<sup>9</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/SQL" title="sql">sql<sup>3</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/STATISTICS" title="statistics">statistics<sup>5</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/STREAMING" title="streaming">streaming<sup>1</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/TIME-SERIES" title="time-series">time-series<sup>2</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/TRAVEL" title="travel">travel<sup>1</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/UNIT-TEST" title="unit-test">unit-test<sup>1</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/VBA" title="vba">vba<sup>1</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/WINDOWS" title="windows">windows<sup>1</sup></a></li>
      
		</ul>
</div>



  
  <div class="archiveslist">
    <p class="asidetitle">Archives</p>
    <ul class="archive-list">
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2021-06">202106</a><span class="archive-list-count">1</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2020-05">202005</a><span class="archive-list-count">12</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2019-09">201909</a><span class="archive-list-count">1</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2018-09">201809</a><span class="archive-list-count">4</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2018-08">201808</a><span class="archive-list-count">1</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2018-06">201806</a><span class="archive-list-count">2</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2018-05">201805</a><span class="archive-list-count">4</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2018-04">201804</a><span class="archive-list-count">5</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2018-03">201803</a><span class="archive-list-count">5</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2018-01">201801</a><span class="archive-list-count">2</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2017-12">201712</a><span class="archive-list-count">1</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2017-11">201711</a><span class="archive-list-count">1</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2017-10">201710</a><span class="archive-list-count">1</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2017-09">201709</a><span class="archive-list-count">10</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2017-08">201708</a><span class="archive-list-count">2</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2017-07">201707</a><span class="archive-list-count">4</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2017-05">201705</a><span class="archive-list-count">3</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2017-04">201704</a><span class="archive-list-count">2</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2017-03">201703</a><span class="archive-list-count">20</span>
      </li>
      
    </ul>

  </div>


  

<div class="tagcloudlist">
  <p class="asidetitle">Tags Cloud</p>
  <div class="tagcloudlist clearfix">
    
    <a href="https://binnz.github.io/tags/android" style="font-size: 12px;">android</a>
    
    <a href="https://binnz.github.io/tags/apache-pig" style="font-size: 12px;">apache-pig</a>
    
    <a href="https://binnz.github.io/tags/association-analysis" style="font-size: 12px;">association-analysis</a>
    
    <a href="https://binnz.github.io/tags/beer" style="font-size: 12px;">beer</a>
    
    <a href="https://binnz.github.io/tags/classification" style="font-size: 12px;">classification</a>
    
    <a href="https://binnz.github.io/tags/clustering" style="font-size: 12px;">clustering</a>
    
    <a href="https://binnz.github.io/tags/conference" style="font-size: 12px;">conference</a>
    
    <a href="https://binnz.github.io/tags/data-mining" style="font-size: 12px;">data-mining</a>
    
    <a href="https://binnz.github.io/tags/data-science" style="font-size: 12px;">data-science</a>
    
    <a href="https://binnz.github.io/tags/database" style="font-size: 12px;">database</a>
    
    <a href="https://binnz.github.io/tags/deep-learning" style="font-size: 12px;">deep-learning</a>
    
    <a href="https://binnz.github.io/tags/elasticsearch" style="font-size: 12px;">elasticsearch</a>
    
    <a href="https://binnz.github.io/tags/graph" style="font-size: 12px;">graph</a>
    
    <a href="https://binnz.github.io/tags/hadoop" style="font-size: 12px;">hadoop</a>
    
    <a href="https://binnz.github.io/tags/information-retrieval" style="font-size: 12px;">information-retrieval</a>
    
    <a href="https://binnz.github.io/tags/java" style="font-size: 12px;">java</a>
    
    <a href="https://binnz.github.io/tags/machine-learning" style="font-size: 12px;">machine-learning</a>
    
    <a href="https://binnz.github.io/tags/neural-network" style="font-size: 12px;">neural-network</a>
    
    <a href="https://binnz.github.io/tags/nlp" style="font-size: 12px;">nlp</a>
    
    <a href="https://binnz.github.io/tags/nltk" style="font-size: 12px;">nltk</a>
    
    <a href="https://binnz.github.io/tags/python" style="font-size: 12px;">python</a>
    
    <a href="https://binnz.github.io/tags/r" style="font-size: 12px;">r</a>
    
    <a href="https://binnz.github.io/tags/relation-algebra" style="font-size: 12px;">relation-algebra</a>
    
    <a href="https://binnz.github.io/tags/scikit-learn" style="font-size: 12px;">scikit-learn</a>
    
    <a href="https://binnz.github.io/tags/spark" style="font-size: 12px;">spark</a>
    
    <a href="https://binnz.github.io/tags/sql" style="font-size: 12px;">sql</a>
    
    <a href="https://binnz.github.io/tags/statistics" style="font-size: 12px;">statistics</a>
    
    <a href="https://binnz.github.io/tags/streaming" style="font-size: 12px;">streaming</a>
    
    <a href="https://binnz.github.io/tags/time-series" style="font-size: 12px;">time-series</a>
    
    <a href="https://binnz.github.io/tags/travel" style="font-size: 12px;">travel</a>
    
    <a href="https://binnz.github.io/tags/unit-test" style="font-size: 12px;">unit-test</a>
    
    <a href="https://binnz.github.io/tags/vba" style="font-size: 12px;">vba</a>
    
    <a href="https://binnz.github.io/tags/windows" style="font-size: 12px;">windows</a>
    
  </div>
</div>



  

</aside>
</div>

  </div>
  <footer><div id="footer" >
  <div class="line">
    <span></span>
    
    <div style='background:no-repeat url("https://binnz.github.io/img/US-MT-EPS-02-6001.png") left top;-webkit-background-size:6.875em 6.875em;-moz-background-size:6.875em 6.875em;background-size:6.875em 6.875em;' class="author" ></div>
  </div>
  <section class="info">
    <p>hehe</p>
  </section>
  <div class="social-font clearfix">
    <a href='http://weibo.com/coderzh' target="_blank" title="weibo"></a>
    <a href='https://twitter.com/coderzh' target="_blank" title="twitter"></a>
    <a href='https://github.com/binnz' target="_blank" class="icon-github" title="github"></a>
    <a href='https://www.facebook.com/coderzh' target="_blank" title="facebook"></a>
    <a href='https://www.linkedin.com/coderzh' target="_blank" title="linkedin"></a>
  </div>
  <p class="copyright">Powered by <a href="http://gohugo.io" target="_blank" title="hugo">hugo</a> and Theme by <a href="https://github.com/coderzh/hugo-pacman-theme" target="_blank" title="hugo-pacman-theme">hugo-pacman-theme</a>  2021
    
    <a href="https://binnz.github.io/" title="California Dreaming">California Dreaming</a>
    
  </p>
</div>
</footer>
  <script src="https://binnz.github.io/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
done = false;
$(document).ready(function(){
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize();
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  $('form.search').on('submit', function (event) {
    if (false === done) {
      event.preventDefault();
      var orgVal = $(this).find('#search').val();
      $(this).find('#search').val('site:https:\/\/binnz.github.io\/ ' + orgVal);
      done = true;
      $(this).submit();
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>

<script type="text/javascript">
$(document).ready(function(){
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span></span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://b.bshare.cn/barCode?site=weixin&url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});
</script>





</body>
</html>
