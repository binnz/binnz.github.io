<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Practice in R: Monte Carlo Simulation &amp; Central Limit Theorem (CLT) - California Dreaming</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
  
  <meta name="description" content="This is a practice in R for realization of Monte Carlo Simulation, Central Limit Theorem (CLT), normal approximation, and so on.">
  
  <meta itemprop="name" content="Practice in R: Monte Carlo Simulation &amp; Central Limit Theorem (CLT) - California Dreaming">
  <meta itemprop="description" content="This is a practice in R for realization of Monte Carlo Simulation, Central Limit Theorem (CLT), normal approximation, and so on.">
  <meta itemprop="image" content="https://binnz.github.io/img/author.jpg">
  
  
  <meta name="twitter:description" content="">
  
  <link rel="shortcut icon" href="https://binnz.github.io/img/favicon.ico"/>
  <link rel="apple-touch-icon" href="https://binnz.github.io/apple-touch-icon.png" />
  <link rel="apple-touch-icon-precomposed" href="https://binnz.github.io/apple-touch-icon.png" />
  <link rel="stylesheet" href="https://binnz.github.io/highlight/styles/github.css">
  <script src="https://binnz.github.io/highlight/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  
  <link rel="stylesheet" href="https://binnz.github.io/font/hack/css/hack.min.css">
  <link rel="stylesheet" href="https://binnz.github.io/css/style.css">
</head>

<body>
  <header>
    <div>
  <div style="height:150px; width:100%; clear:both;"></div>
  <div id="textlogo">
    <h1 class="site-name"><a href="https://binnz.github.io/" title="California Dreaming">California Dreaming</a></h1>
    <h2 class="blog-motto"></h2>
  </div>
  <div class="navbar"><a class="navbutton navmobile" href="#" title="menu"></a></div>
			<div style="height:50px; width:100%; clear:both;"></div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="menu">
			</a><div style="height:50px; width:100%; clear:both;"></div></div>
  <nav class="animated">
    <ul>
      
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/post/">Archives</a></li>
      
      <li><a href="/tags/">Tags</a></li>
      
      
      <li>
        <form class="search" method="get" action="https://www.google.com/search">
          <div>
            <input type="text" id="search" name="q" placeholder='Search'>
          </div>
        </form>
      </li>
    </ul>
  </nav>
</div>

  </header>
  <div id="container">
    <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody">
    <header class="article-info clearfix">
  <h1 itemprop="name">
      <a href="https://binnz.github.io/post/2018-09-10-r2/" title="Practice in R: Monte Carlo Simulation &amp; Central Limit Theorem (CLT)" itemprop="url">Practice in R: Monte Carlo Simulation &amp; Central Limit Theorem (CLT)</a>
  </h1>
  <p class="article-author">By
    
      <a href="" title="">you</a>
    
  </p>
  <p class="article-time">
    <time datetime="2018-09-10 00:00:00 &#43;0000 UTC" itemprop="datePublished">2018-09-10</time>
  </p>
</header>

	<div class="article-content">
    
    <p>This is a practice in R for realization of Monte Carlo Simulation, Central Limit Theorem (CLT), normal approximation, and so on.</p>
<h2 id="game-of-roullete">Game of Roullete</h2>
<p>In the game of <a href="https://en.wikipedia.org/wiki/Roulette">roullete</a> you can bet on several things including black or red. On this bet, if you win, you double your money; if you fail, you lose what you bet. For example, you bet 1 dollar on black. When the result is black, you earn 1 dollar; when the result is red or green, you lose 1 dollar. How does the casino make money on this then? If you look at the possibilities, you realize that the chance of red or black are both slightly less than 1/2. There are two green spots, so the landing on black (or red) is actually 18/38, or 9/19.</p>
<h3 id="sampling-function">Sampling Function</h3>
<p>Let&rsquo;s make a quick sampling model for this simple version of roulette. You are going to bet 1 dollar each time you play and always bet on black. Make a model for this process using the <code>sample</code> function. Write a function <code>get_outcome</code> that takes as an argument the number of times you play $N$ and returns your earnings $S_N$.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-R" data-lang="R"><span class="n">get_outcome</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">N</span><span class="p">){</span>
  <span class="c1">## Create samples</span>
  <span class="n">roulette</span> <span class="o">&lt;-</span> <span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&#34;red&#34;</span><span class="p">,</span> <span class="s">&#34;black&#34;</span><span class="p">,</span> <span class="s">&#34;green&#34;</span><span class="p">),</span> <span class="n">times</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">18</span><span class="p">,</span><span class="m">18</span><span class="p">,</span><span class="m">2</span><span class="p">))</span>
  
  <span class="c1">## Do sampling</span>
  <span class="n">events</span> <span class="o">&lt;-</span> <span class="nf">replicate</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="nf">sample</span><span class="p">(</span><span class="n">roulette</span><span class="p">,</span> <span class="m">1</span><span class="p">))</span>
  
  <span class="c1">## When the result is black, you earn 1 dollar; otherwise, you lose 1 dollar</span>
  <span class="n">earnings</span> <span class="o">&lt;-</span> <span class="nf">sapply</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">e</span><span class="p">){</span>
    <span class="nf">if</span><span class="p">(</span><span class="n">e</span><span class="o">==</span><span class="s">&#34;black&#34;</span><span class="p">){</span>
      <span class="nf">return</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">else</span><span class="p">{</span>
      <span class="nf">return</span><span class="p">(</span><span class="m">-1</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">})</span>
  
  <span class="c1">## Sum up the earnings for N times</span>
  <span class="n">SN</span> <span class="o">&lt;-</span> <span class="nf">sum</span><span class="p">(</span><span class="n">earnings</span><span class="p">)</span>
  <span class="nf">return</span><span class="p">(</span><span class="n">SN</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="monte-carlo-simulation-for-the-distribution-of-total-earnings">Monte Carlo Simulation for the distribution of total earnings</h3>
<p>Use Monte Carlo simulation to study the distribution of total earnings $S_N$ for $N=10,25,100,1000$. That is, study the distribution of earnings for different number of plays. <strong>Are they similar to the normal distribution</strong>? How do the <strong>expected values</strong> and <strong>standard errors</strong> change with $N$?</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-R" data-lang="R"><span class="c1">## Define standard error function</span>
<span class="n">stderr</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span>
  <span class="nf">sqrt</span><span class="p">(</span><span class="nf">mean</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="n">^2</span><span class="p">))</span>
<span class="p">}</span>

<span class="c1">## Do Monte Carlo simulation with different value of N</span>
<span class="n">B</span> <span class="o">&lt;-</span> <span class="m">10</span><span class="n">^5</span>
<span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="m">2</span><span class="p">))</span>
<span class="n">E_SN</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">()</span>
<span class="nf">for</span><span class="p">(</span><span class="n">N</span> <span class="n">in</span> <span class="nf">c</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">25</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="m">1000</span><span class="p">)){</span>
  
  <span class="c1">## Play the game B runs, each run we bet N times and record the total earning.</span>
  <span class="n">events</span> <span class="o">&lt;-</span> <span class="nf">replicate</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="nf">get_outcome</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
  <span class="n">E_SN</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">E_SN</span><span class="p">,</span> <span class="nf">mean</span><span class="p">(</span><span class="n">events</span><span class="p">))</span>
  <span class="nf">cat</span><span class="p">(</span><span class="s">&#34;N=&#34;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="s">&#34;\n------\n&#34;</span><span class="p">)</span>
  <span class="nf">cat</span><span class="p">(</span><span class="s">&#34;Expected Value: &#34;</span><span class="p">,</span> <span class="nf">mean</span><span class="p">(</span><span class="n">events</span><span class="p">),</span> <span class="s">&#34;\n&#34;</span><span class="p">)</span>
  <span class="nf">cat</span><span class="p">(</span><span class="s">&#34;Standard Error: &#34;</span><span class="p">,</span> <span class="nf">stderr</span><span class="p">(</span><span class="n">events</span><span class="p">),</span> <span class="s">&#34;\n\n&#34;</span><span class="p">)</span>
  
  <span class="c1">## Count the occurrence of different values of total earnings</span>
  <span class="n">tab</span> <span class="o">&lt;-</span> <span class="nf">table</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
  
  <span class="c1">## X-Y Plot</span>
  <span class="nf">plot</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">tab</span><span class="p">),</span> <span class="nf">as.vector</span><span class="p">(</span><span class="n">tab</span><span class="p">),</span> <span class="n">main</span><span class="o">=</span><span class="nf">paste</span><span class="p">(</span><span class="s">&#34;Distribution of Earnings ( N =&#34;</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="s">&#34;)&#34;</span><span class="p">),</span> <span class="n">xlab</span><span class="o">=</span><span class="s">&#34;total earning&#34;</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="s">&#34;frequencies&#34;</span><span class="p">)</span>
  
  <span class="c1">## Q-Q Plot</span>
  <span class="n">z</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="n">events</span> <span class="o">-</span> <span class="nf">mean</span><span class="p">(</span><span class="n">events</span><span class="p">))</span> <span class="o">/</span> <span class="nf">stderr</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
  <span class="nf">qqnorm</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">main</span><span class="o">=</span><span class="nf">paste</span><span class="p">(</span><span class="s">&#34;Normal Q-Q Plot ( N =&#34;</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="s">&#34;)&#34;</span><span class="p">))</span>
  <span class="nf">abline</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">## N= 10 </span>
<span class="c1">## ------</span>
<span class="c1">## Expected Value:  -0.53592 </span>
<span class="c1">## Standard Error:  3.145993</span>

<span class="c1">## N= 25 </span>
<span class="c1">## ------</span>
<span class="c1">## Expected Value:  -1.33416 </span>
<span class="c1">## Standard Error:  4.991162</span>

<span class="c1">## N= 100 </span>
<span class="c1">## ------</span>
<span class="c1">## Expected Value:  -5.22196 </span>
<span class="c1">## Standard Error:  9.991617</span>

<span class="c1">## N= 1000 </span>
<span class="c1">## ------</span>
<span class="c1">## Expected Value:  -52.67244 </span>
<span class="c1">## Standard Error:  31.60298</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="https://i.imgur.com/AXNA11V.png" alt=""></p>
<h3 id="monte-carlo-simulation-for-the-distribution-of-average-winnings">Monte Carlo Simulation for the distribution of average winnings</h3>
<p>Repeat the previous simulation but for the average winnings $S_N/N$.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-R" data-lang="R"><span class="c1">## Do Monte Carlo simulation with different value of N</span>
<span class="n">B</span> <span class="o">&lt;-</span> <span class="m">10</span><span class="n">^5</span>
<span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="m">2</span><span class="p">))</span>
<span class="nf">for</span><span class="p">(</span><span class="n">N</span> <span class="n">in</span> <span class="nf">c</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">25</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="m">1000</span><span class="p">)){</span>
  
  <span class="c1">## Play the game B runs, each run we bet N times and record the average earning.</span>
  <span class="n">events</span> <span class="o">&lt;-</span> <span class="nf">replicate</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="nf">get_outcome</span><span class="p">(</span><span class="n">N</span><span class="p">))</span><span class="o">/</span><span class="n">N</span>
  <span class="nf">cat</span><span class="p">(</span><span class="s">&#34;N=&#34;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="s">&#34;\n------\n&#34;</span><span class="p">)</span>
  <span class="nf">cat</span><span class="p">(</span><span class="s">&#34;Expected Value: &#34;</span><span class="p">,</span> <span class="nf">mean</span><span class="p">(</span><span class="n">events</span><span class="p">),</span> <span class="s">&#34;\n&#34;</span><span class="p">)</span>
  <span class="nf">cat</span><span class="p">(</span><span class="s">&#34;Standard Error: &#34;</span><span class="p">,</span> <span class="nf">stderr</span><span class="p">(</span><span class="n">events</span><span class="p">),</span> <span class="s">&#34;\n&#34;</span><span class="p">)</span>
  <span class="nf">cat</span><span class="p">(</span><span class="s">&#34;\n&#34;</span><span class="p">)</span>
  
  <span class="c1">## Count the occurrence of different values of average earnings</span>
  <span class="n">tab</span> <span class="o">&lt;-</span> <span class="nf">table</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
  
  <span class="c1">## X-Y Plot</span>
  <span class="nf">plot</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">tab</span><span class="p">),</span> <span class="nf">as.vector</span><span class="p">(</span><span class="n">tab</span><span class="p">),</span> <span class="n">main</span><span class="o">=</span><span class="nf">paste</span><span class="p">(</span><span class="s">&#34;Distribution of Earnings ( N =&#34;</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="s">&#34;)&#34;</span><span class="p">),</span> <span class="n">xlab</span><span class="o">=</span><span class="s">&#34;total earning&#34;</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="s">&#34;frequencies&#34;</span><span class="p">)</span>
  
  <span class="c1">## Q-Q Plot</span>
  <span class="n">z</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="n">events</span> <span class="o">-</span> <span class="nf">mean</span><span class="p">(</span><span class="n">events</span><span class="p">))</span> <span class="o">/</span> <span class="nf">stderr</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
  <span class="nf">qqnorm</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">main</span><span class="o">=</span><span class="nf">paste</span><span class="p">(</span><span class="s">&#34;Normal Q-Q Plot ( N =&#34;</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="s">&#34;)&#34;</span><span class="p">))</span>
  <span class="nf">abline</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">## N= 10 </span>
<span class="c1">## ------</span>
<span class="c1">## Expected Value:  -0.05146 </span>
<span class="c1">## Standard Error:  0.3141412</span>

<span class="c1">## N= 25 </span>
<span class="c1">## ------</span>
<span class="c1">## Expected Value:  -0.0523152 </span>
<span class="c1">## Standard Error:  0.1987781</span>

<span class="c1">## N= 100 </span>
<span class="c1">## ------</span>
<span class="c1">## Expected Value:  -0.0529774 </span>
<span class="c1">## Standard Error:  0.09981486</span>

<span class="c1">## N= 1000 </span>
<span class="c1">## ------</span>
<span class="c1">## Expected Value:  -0.0526206 </span>
<span class="c1">## Standard Error:  0.03166803</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="https://i.imgur.com/XWuEPOi.png" alt=""></p>
<h3 id="comparison-between-theoretical-values-and-simulation-results">Comparison between theoretical values and simulation results</h3>
<p>What is the expected value of $S_N$ in the previous simulation theoretically? What is the standard error of $S_N$? Are they close to your simulation results?</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-R" data-lang="R"><span class="n">mu</span> <span class="o">&lt;-</span> <span class="m">1</span><span class="o">*</span><span class="p">(</span><span class="m">9</span><span class="o">/</span><span class="m">19</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="m">-1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="m">10</span><span class="o">/</span><span class="m">19</span><span class="p">)</span>
<span class="n">N</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">25</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="m">1000</span><span class="p">)</span>
<span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="s">&#34;N&#34;</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">25</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="m">1000</span><span class="p">),</span> <span class="s">&#34;theoretical values&#34;</span><span class="o">=</span><span class="n">mu</span><span class="o">*</span><span class="n">N</span><span class="p">,</span> <span class="s">&#34;simulation results&#34;</span><span class="o">=</span><span class="n">E_SN</span><span class="p">)</span>
<span class="n">x</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">##      N theoretical.values simulation.results</span>
<span class="c1">## 1   10         -0.5263158           -0.53592</span>
<span class="c1">## 2   25         -1.3157895           -1.33416</span>
<span class="c1">## 3  100         -5.2631579           -5.22196</span>
<span class="c1">## 4 1000        -52.6315789          -52.67244</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>For every bet, the expected earning can be calculated as $1 \times p+(-1) \times (1-p)$, where $p$ is the probability that the result is black.   So as the table above, we can calculate the theoretical values of earnings when you bet 10 times or more.   Compare our Monte Carlo simulation results with these  theoretical values, we can see that the differences between them are no more than 0.06.   That is, our simulation results are very close to the theoretical values when calculating the expected values of earnings when we bet 10, 25, 100, or 1000 times.</p>
</blockquote>
<h3 id="approximate-the-probability-that-the-casino-loses-money">Approximate the probability that the casino loses money</h3>
<p>Use the Central Limit Theorem (CLT) to approximate the probability that the casino loses money when you play 25 times. Then use a Monte Carlo simulation to confirm.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-R" data-lang="R"><span class="n">N</span> <span class="o">&lt;-</span> <span class="m">25</span>

<span class="c1">## Use the Central Limit Theorem (CLT) to approximate</span>
<span class="n">mu</span> <span class="o">&lt;-</span> <span class="m">1</span><span class="o">*</span><span class="p">(</span><span class="m">9</span><span class="o">/</span><span class="m">19</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="m">-1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="m">10</span><span class="o">/</span><span class="m">19</span><span class="p">)</span>
<span class="n">std.dev</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="p">(</span><span class="m">-1</span><span class="p">))</span><span class="o">*</span><span class="nf">sqrt</span><span class="p">((</span><span class="m">9</span><span class="o">/</span><span class="m">19</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="m">10</span><span class="o">/</span><span class="m">19</span><span class="p">))</span>
<span class="n">mean</span> <span class="o">&lt;-</span> <span class="n">N</span><span class="o">*</span><span class="n">mu</span>
<span class="n">s</span> <span class="o">&lt;-</span> <span class="nf">sqrt</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">std.dev</span>
<span class="n">expected</span> <span class="o">&lt;-</span> <span class="m">1</span> <span class="o">-</span> <span class="nf">pnorm</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">mean</span> <span class="o">=</span> <span class="n">mean</span><span class="p">,</span> <span class="n">sd</span> <span class="o">=</span> <span class="n">s</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&#34;With CLT approximation, \nthe probability that the casino loses money (N = 25) is&#34;</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="s">&#34;.\n\n&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">## With CLT approximation, </span>
<span class="c1">## the probability that the casino loses money (N = 25) is 0.3960737 .</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-R" data-lang="R"><span class="c1">## Use a Monte Carlo simulation to confirm</span>
<span class="n">B</span> <span class="o">&lt;-</span> <span class="m">10</span><span class="n">^5</span>
<span class="n">events</span> <span class="o">&lt;-</span> <span class="nf">replicate</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="nf">get_outcome</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
<span class="n">simulated</span> <span class="o">&lt;-</span> <span class="nf">mean</span><span class="p">(</span><span class="n">events</span> <span class="o">&gt;</span> <span class="m">0</span><span class="p">)</span>  
<span class="nf">cat</span><span class="p">(</span><span class="s">&#34;With Monte Carlo simulation, \nthe probability that the casino loses money (N = 25) is&#34;</span><span class="p">,</span> <span class="n">simulated</span><span class="p">,</span> <span class="s">&#34;.\n&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">## With Monte Carlo simulation, </span>
<span class="c1">## the probability that the casino loses money (N = 25) is 0.39489 .</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>To use the Central Limit Theorem (CLT) for approximaton on the eaning of each bet, we need to calculate the expectation and the standard deviation of the earning for a bet, which are $\mu = 1 \times p+(-1) \times (1-p)$ and $\sigma = \vert 1-(-1)\vert \times \sqrt{p \times (1-p)}$ respectively.   Then we use $25 \times \mu$ and $\sqrt{25} \times \sigma$ as the input of <code>pnorm</code> to calculate the approximated probability.</p>
<p>Compare the approximated probility with the probability calculated from Monte Carlo simulation, we can find that they are really close.   That is, the probability of the earnings/loses of the casino can actually be calculated from the approximation of Central Limit Theorem.</p>
</blockquote>
<h3 id="the-probability-that-the-casino-loses-money-over-playing-times">The probability that the casino loses money over playing times</h3>
<p>In general, what is the probability that the casino loses money as a function of $N$? Make a plot for values ranging from 25 to 1,000. Why does the casino give you free drinks if you keep playing?</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-R" data-lang="R"><span class="c1">## Define the function that calculates the probability </span>
<span class="c1">## that the casino loses money if you play N times</span>
<span class="n">CLT_approximation</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">N</span><span class="p">){</span>
  <span class="n">mu</span> <span class="o">&lt;-</span> <span class="m">1</span><span class="o">*</span><span class="p">(</span><span class="m">9</span><span class="o">/</span><span class="m">19</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="m">-1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="m">10</span><span class="o">/</span><span class="m">19</span><span class="p">)</span>
  <span class="n">std.dev</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="p">(</span><span class="m">-1</span><span class="p">))</span><span class="o">*</span><span class="nf">sqrt</span><span class="p">((</span><span class="m">9</span><span class="o">/</span><span class="m">19</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="m">10</span><span class="o">/</span><span class="m">19</span><span class="p">))</span>
  <span class="n">mean</span> <span class="o">&lt;-</span> <span class="n">N</span><span class="o">*</span><span class="n">mu</span>
  <span class="n">s</span> <span class="o">&lt;-</span> <span class="nf">sqrt</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">std.dev</span>
  <span class="n">expected</span> <span class="o">&lt;-</span> <span class="m">1</span> <span class="o">-</span> <span class="nf">pnorm</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">mean</span> <span class="o">=</span> <span class="n">mean</span><span class="p">,</span> <span class="n">sd</span> <span class="o">=</span> <span class="n">s</span><span class="p">)</span>
  <span class="nf">return</span><span class="p">(</span><span class="n">expected</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">## Calculate the probability that the casino loses money</span>
<span class="c1">## for different values of N (from N=25 to N=1000)</span>
<span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">seq</span><span class="p">(</span><span class="m">25</span><span class="p">,</span> <span class="m">1000</span><span class="p">)</span>
<span class="n">y</span> <span class="o">&lt;-</span> <span class="nf">sapply</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">CLT_approximation</span><span class="p">)</span>

<span class="c1">## X-Y Plot</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cex</span><span class="o">=</span><span class="m">0.3</span><span class="p">,</span> <span class="n">xlab</span><span class="o">=</span><span class="s">&#34;N&#34;</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="s">&#34;Probabily&#34;</span><span class="p">,</span> <span class="n">main</span><span class="o">=</span><span class="s">&#34;Probabily that the casino loses money&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="https://i.imgur.com/XKorcZU.png" alt=""></p>
<blockquote>
<p>Using the approximation of Central Limit Theorem, we can see that the probability that the casino loses money decreases as $N$(the number of times a player plays the game) increases.   This is why the casino hopes the player can keep playing at the same desk as long as possible.</p>
</blockquote>
<h2 id="predict-the-outcomes-of-the-usa-pesidential-election-of-each-state">Predict the outcomes of the USA pesidential election of each state</h2>
<p>In 2012 Nate Silver, and other data scientists, <a href="http://mashable.com/2012/11/07/nate-silver-wins/#2WkAUaXCVaqw">predicted the outcomes of the USA pesidential election of each state correctly</a>. They did this by aggregating data from many polls to create more precise estimates than what one single poll can provide.</p>
<p>In this problem, we will try to predict the result of the 2016 USA pesidential election by studying the performance of polls in elections that already occurred and then aggregating results.</p>
<h3 id="central-limit-theory-clt-on-poll-results">Central limit theory (CLT) on poll results</h3>
<p>Let $X_{i}=1$ if the $i$th voter is democrat, $X_{i}=0$ if republican for $i=1, \cdots, N$. The central limit theory (CLT) says that if $N$ is large,</p>
<p>$$ \bar{X}=\frac{1}{N}\sum_{i=1}^{N}X_{i}=\hat{p} \sim N(p, \frac{\hat{p}(1-\hat{p})}{N}) $$</p>
<p>where $p$ is the proportion of democrats in the population. Based on the above CLT result, what is the 95% CI for $p$?</p>
<blockquote>
<p>The Central Limit Theorem tells us that the distribution of any random variable $X$ is approximately normal with its mean $\mu$ (the population mean) and its standard deviation $\sigma/\sqrt{n}$ where $\sigma$ is the population standard deviation and $n$ is the population size.   As a result, the random interval  $\mu - Z_{0.975} \frac{\sigma}{\sqrt{n}}$ to  $\mu + Z_{0.975}\frac{\sigma}{\sqrt{n}}$ (where $Z_{0.975}$ is approximately 1.96) has a 95% probability of falling on the true value of $X$.</p>
<p>Since we know the distribution of $p$ (the proportion of democrats in the population), so the 95% confidence interval of $p$ can be formulated as below:</p>
<p>$$
\bar{X}-Z_{0.975}\frac{S_{X}}{\sqrt{N}} \leq p \leq \bar{X}+Z_{0.975}\frac{S_{X}}{\sqrt{N}}
$$</p>
<p>where $N$ is the sample size, $\bar{X}$ is acutually $\hat{p}$, and $S_{X}$ is the sample standard deviation $\sqrt{\hat{p}(1-\hat{p})}$.</p>
</blockquote>
<h3 id="confidence-interval-ci">Confidence interval (CI)</h3>
<p>Suppose that the true population proportion $p=0.47$. Perform a simulation for $N=30$ to show that the CI you create in the previous section is actually a 95% CI.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-R" data-lang="R"><span class="n">p</span> <span class="o">&lt;-</span> <span class="m">0.47</span>
<span class="n">N</span> <span class="o">&lt;-</span> <span class="m">30</span>
<span class="n">B</span> <span class="o">&lt;-</span> <span class="m">10</span><span class="n">^5</span>

<span class="c1">## Generate population corresponds to true population distribution (p=0.47)</span>
<span class="n">voters</span> <span class="o">&lt;-</span> <span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> <span class="n">times</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">53</span><span class="p">,</span><span class="m">47</span><span class="p">))</span>

<span class="c1">## Do Monte Carlo simulation B times</span>
<span class="n">coverd</span> <span class="o">&lt;-</span> <span class="m">0</span>
<span class="nf">for</span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="m">1</span><span class="o">:</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="c1">## Sample 30 voters from population</span>
  <span class="n">X</span> <span class="o">&lt;-</span> <span class="nf">sample</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span> <span class="n">N</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0.53</span><span class="p">,</span> <span class="m">0.47</span><span class="p">))</span>
  
  <span class="c1">## Calculate confidence interval for this sampling</span>
  <span class="n">p_hat</span> <span class="o">&lt;-</span> <span class="nf">mean</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
  <span class="n">se</span> <span class="o">&lt;-</span> <span class="nf">sqrt</span><span class="p">(</span><span class="n">p_hat</span><span class="o">*</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">p_hat</span><span class="p">)</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>   <span class="c1">#se &lt;- sd(X)/sqrt(N)</span>
  <span class="n">Q</span> <span class="o">&lt;-</span> <span class="nf">qnorm</span><span class="p">(</span><span class="m">0.975</span><span class="p">)</span>               <span class="c1">#Q &lt;- qt(0.975, df=(N-1))</span>
  <span class="n">interval</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">p_hat</span><span class="o">-</span><span class="n">Q</span><span class="o">*</span><span class="n">se</span><span class="p">,</span> <span class="n">p_hat</span><span class="o">+</span><span class="n">Q</span><span class="o">*</span><span class="n">se</span><span class="p">)</span>
  
  <span class="c1">## If true parameter falls in the interval, then increment the count</span>
  <span class="nf">if</span><span class="p">(</span><span class="n">p</span> <span class="o">&lt;=</span> <span class="n">interval[2]</span> <span class="o">&amp;</span> <span class="n">p</span> <span class="o">&gt;=</span> <span class="n">interval[1]</span><span class="p">){</span>
    <span class="n">coverd</span> <span class="o">&lt;-</span> <span class="n">coverd</span> <span class="o">+</span> <span class="m">1</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nf">cat</span><span class="p">(</span><span class="s">&#34;Simulation shows that for our random confidence interval, the probability of falling on the parameter we are estimating is&#34;</span><span class="p">,</span> <span class="n">coverd</span><span class="o">/</span><span class="n">B</span><span class="p">,</span> 
    <span class="s">&#34;\nSince The central limit theorem applies poorly to binomial distribution with a sample size less than 30, we should increase the value of N (e.g., N = 100), then the probability would be close to 95%.&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">## Simulation shows that for our random confidence interval, the probability of falling on the parameter we are estimating is 0.93203 </span>
<span class="c1">## Since The central limit theorem applies poorly to binomial distribution with a sample size less than 30, we should increase the value of N (e.g., N = 100), then the probability would be close to 95%.</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="test-statistic">Test statistic</h3>
<p>We are interested in testing $H_{0}: p=0.5$ versus $H_{a}: p \neq 0.5$. The test statistic we will use is</p>
<p>$$ t=\frac{\hat{p}-0.5}{\sqrt{\frac{\hat{p}(1-\hat{p})}{N}}} $$</p>
<p>If a poll drawed $N=100$ voters and obtained the proportion of democrates $\hat{p}=0.49$. What is the p-value for this poll result? Please calculate the p-value using the population data and the normal approximation.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-R" data-lang="R"><span class="c1">## Define t-statistics function</span>
<span class="n">tstat</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">N</span><span class="p">){</span> <span class="nf">return</span><span class="p">((</span><span class="n">p</span><span class="m">-0.5</span><span class="p">)</span><span class="o">/</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">N</span><span class="p">))</span> <span class="p">}</span>

<span class="c1">## Calculate t-statistics for p hat</span>
<span class="n">p</span> <span class="o">&lt;-</span> <span class="m">0.49</span>
<span class="n">N</span> <span class="o">&lt;-</span> <span class="m">100</span>
<span class="n">obststat</span> <span class="o">&lt;-</span> <span class="nf">tstat</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

<span class="c1">## Calculate the distribution of t-statistics using the population data corresponds to null hypothesis</span>
<span class="n">B</span> <span class="o">&lt;-</span> <span class="m">10</span><span class="n">^5</span>
<span class="n">null_distribution</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">N</span><span class="p">){</span>
    <span class="n">p</span> <span class="o">&lt;-</span> <span class="nf">mean</span><span class="p">(</span><span class="nf">sample</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span> <span class="n">N</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span> <span class="m">0.5</span><span class="p">)))</span>
    <span class="nf">return</span><span class="p">(</span><span class="nf">tstat</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
<span class="p">}</span>
<span class="n">null</span> <span class="o">&lt;-</span> <span class="nf">replicate</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="nf">null_distribution</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
<span class="n">pval</span> <span class="o">&lt;-</span> <span class="nf">mean</span><span class="p">(</span><span class="n">null</span> <span class="o">&gt;</span> <span class="nf">abs</span><span class="p">(</span><span class="n">obststat</span><span class="p">))</span> <span class="o">+</span> <span class="nf">mean</span><span class="p">(</span><span class="n">null</span> <span class="o">&lt;</span> <span class="o">-</span><span class="nf">abs</span><span class="p">(</span><span class="n">obststat</span><span class="p">))</span>

<span class="c1">## Because of the definition of p and N, the t-statistics generated from this simulation</span>
<span class="c1">## will aways be multiples of 0.2, so I fit a smooth curve to approach the real distribution</span>
<span class="c1">## and then calculate the p-value from the curve.</span>
<span class="n">tab</span> <span class="o">&lt;-</span> <span class="nf">sapply</span><span class="p">(</span><span class="nf">seq</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">100</span><span class="p">)</span><span class="o">/</span><span class="m">100</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">e</span><span class="p">){</span><span class="nf">quantile</span><span class="p">(</span><span class="n">null</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">e</span><span class="p">))})</span>
<span class="n">null_smoothed</span> <span class="o">&lt;-</span> <span class="nf">predict</span><span class="p">(</span><span class="nf">loess</span><span class="p">(</span><span class="nf">as.vector</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span> <span class="o">~</span> <span class="nf">seq</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">100</span><span class="p">)))</span>
<span class="n">pval_smoothed</span> <span class="o">&lt;-</span> <span class="nf">mean</span><span class="p">(</span><span class="n">null_smoothed</span> <span class="o">&gt;</span> <span class="nf">abs</span><span class="p">(</span><span class="n">obststat</span><span class="p">))</span> <span class="o">+</span> <span class="nf">mean</span><span class="p">(</span><span class="n">null_smoothed</span> <span class="o">&lt;</span> <span class="o">-</span><span class="nf">abs</span><span class="p">(</span><span class="n">obststat</span><span class="p">))</span>

<span class="c1">## Calculate the p-value using normal approximation</span>
<span class="n">righttail</span> <span class="o">&lt;-</span> <span class="m">1</span> <span class="o">-</span> <span class="nf">pnorm</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">obststat</span><span class="p">))</span>
<span class="n">lefttail</span> <span class="o">&lt;-</span> <span class="nf">pnorm</span><span class="p">(</span><span class="o">-</span><span class="nf">abs</span><span class="p">(</span><span class="n">obststat</span><span class="p">))</span>
<span class="n">npval</span> <span class="o">&lt;-</span> <span class="n">lefttail</span> <span class="o">+</span> <span class="n">righttail</span>

<span class="c1">## Show Result</span>
<span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="s">&#34;method&#34;</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&#34;using population data&#34;</span><span class="p">,</span>
                           <span class="s">&#34;using population data (fit a smooth curve)&#34;</span><span class="p">,</span>  <span class="s">&#34;using normal approximation&#34;</span><span class="p">),</span> 
                <span class="s">&#34;p-value&#34;</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">pval</span><span class="p">,</span> <span class="n">pval_smoothed</span><span class="p">,</span> <span class="n">npval</span><span class="p">))</span>
<span class="n">x</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">##                                       method   p.value</span>
<span class="c1">## 1                      using population data 0.7647800</span>
<span class="c1">## 2 using population data (fit a smooth curve) 0.8400000</span>
<span class="c1">## 3                 using normal approximation 0.8414493</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="data-wrangling">Data wrangling</h3>
<p>Now returing to our analysis of the 2016 USA pesidential election. The first step in our analysis will be to wrangle the data in a way that will simplify the analysis. Ultimately, we want a table of results with each poll represented by a row and including results for each candidate as well as information about the poll such as name and date.</p>
<p>Install and load the <code>pollstR</code> package. This package provides functions to access data in the Huffington Post&rsquo;s database. Read the help file for the <code>pollster_charts_polls()</code> function and write a function that reads the polls' data related to <em>2016 General Election: Trump vs. Clinton</em> in <a href="http://elections.huffingtonpost.com/pollster/2016-general-election-trump-vs-clinton">this chart</a>. Name the object <code>race2016</code>. Hint: select a right <code>slug</code> for this chart.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-R" data-lang="R"><span class="nf">library</span><span class="p">(</span><span class="n">pollstR</span><span class="p">)</span>

<span class="n">slug</span> <span class="o">&lt;-</span> <span class="s">&#34;2016-general-election-trump-vs-clinton&#34;</span>
<span class="n">race2016</span> <span class="o">&lt;-</span> <span class="nf">pollster_charts_polls</span><span class="p">(</span><span class="n">slug</span><span class="p">)</span><span class="n">[[</span><span class="s">&#34;content&#34;</span><span class="n">]]</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="create-a-tidy-data-set">Create a tidy data set</h3>
<p>Examine and familiarize yourself with the <code>race2016</code> object. Note that the <code>content</code> component has a table with election results. Look at the <code>content</code> component and create a new table with only variables: <code>Trump</code>, <code>Clinton</code>, <code>poll_slug</code>, <code>start_date</code>, <code>observations</code>, <code>margin_of_error</code>, and <code>mode</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-R" data-lang="R"><span class="nf">library</span><span class="p">(</span><span class="s">&#34;dplyr&#34;</span><span class="p">)</span>

<span class="n">df</span> <span class="o">&lt;-</span> <span class="n">race2016</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="s">&#34;Trump&#34;</span><span class="p">,</span> <span class="s">&#34;Clinton&#34;</span><span class="p">,</span> <span class="s">&#34;poll_slug&#34;</span><span class="p">,</span> <span class="s">&#34;start_date&#34;</span><span class="p">,</span> <span class="s">&#34;observations&#34;</span><span class="p">,</span> <span class="s">&#34;margin_of_error&#34;</span><span class="p">,</span> <span class="s">&#34;mode&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="visualization-of-poll-data">Visualization of poll data</h3>
<p>To explore these poll data, write codes to create a plot similar to <a href="http://elections.huffingtonpost.com/pollster/2016-general-election-trump-vs-clinton">this chart</a>. Hint: follow the example codes provided in <a href="https://cran.r-project.org/web/packages/pollstR/vignettes/examples.html">this webpage</a>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-R" data-lang="R"><span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="nf">theme_set</span><span class="p">(</span><span class="nf">theme_bw</span><span class="p">())</span>

<span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">Trump</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;Trump&#34;</span><span class="p">),</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">)</span> <span class="o">+</span>
          <span class="nf">geom_smooth</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s">&#34;loess&#34;</span><span class="p">,</span> <span class="n">se</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">Trump</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;Trump&#34;</span><span class="p">))</span> <span class="o">+</span>
          <span class="nf">geom_point</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">Clinton</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;Clinton&#34;</span><span class="p">),</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">)</span> <span class="o">+</span>
          <span class="nf">geom_smooth</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s">&#34;loess&#34;</span><span class="p">,</span> <span class="n">se</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">Clinton</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;Clinton&#34;</span><span class="p">))</span> <span class="o">+</span> 
          <span class="nf">ggtitle</span><span class="p">(</span><span class="s">&#34;2016 General Election: Trump vs. Clinton&#34;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">ylab</span><span class="p">(</span><span class="s">&#34;Support Ratio&#34;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">xlab</span><span class="p">(</span><span class="s">&#34;Date&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="https://i.imgur.com/1FIAb02.png" alt=""></p>
<h3 id="aggregation-of-poll-result">Aggregation of poll result</h3>
<p>Now we want to aggregate these polls' results. We can assume that all these polls were based on independent data. So, in section &ldquo;Create a tidy data set&rdquo;, how many observations does the created table actually show data for? Hint: the column <code>observations</code> indicates the number of voters picked in each poll. By combining these independent polls, how many votes have we observed?</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-R" data-lang="R"><span class="n">votes</span> <span class="o">&lt;-</span> <span class="n">df</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="s">&#34;observations&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">sum</span><span class="p">()</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&#34;The number of votes we have observed is&#34;</span><span class="p">,</span> <span class="n">votes</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">## The number of votes we have observed is 969747</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="estimated-proportion-of-voting-for-trumpclinton">Estimated proportion of voting for Trump/Clinton</h3>
<p>Furthermore, we can deduce how many voters favor Trump and how many voters favor Clinton in each poll. By adding these all up, what are the estimated proportion of voting for Trump and the one of voting for Clinton from these polls?</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-R" data-lang="R"><span class="c1">## Deduce how many voters favor Trump and how many voters favor Clinton in each poll, and add them up</span>
<span class="n">df</span><span class="o">$</span><span class="n">Trump.pop</span> <span class="o">&lt;-</span> <span class="n">df</span><span class="o">$</span><span class="n">Trump</span><span class="o">/</span><span class="m">100</span> <span class="o">*</span> <span class="n">df</span><span class="o">$</span><span class="n">observations</span>
<span class="n">df</span><span class="o">$</span><span class="n">Clinton.pop</span> <span class="o">&lt;-</span> <span class="n">df</span><span class="o">$</span><span class="n">Clinton</span><span class="o">/</span><span class="m">100</span> <span class="o">*</span> <span class="n">df</span><span class="o">$</span><span class="n">observations</span>
<span class="n">votes.Trump</span> <span class="o">&lt;-</span> <span class="n">df</span><span class="o">$</span><span class="n">Trump.pop</span> <span class="o">%&gt;%</span> <span class="nf">sum</span><span class="p">()</span>
<span class="n">votes.Clinton</span> <span class="o">&lt;-</span> <span class="n">df</span><span class="o">$</span><span class="n">Clinton.pop</span> <span class="o">%&gt;%</span> <span class="nf">sum</span><span class="p">()</span>

<span class="c1">## Calcualte the estimated proportion of voting for Trump and the one of voting for Clinton</span>
<span class="n">tab</span> <span class="o">&lt;-</span> <span class="nf">matrix</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">votes.Trump</span><span class="o">/</span><span class="n">votes</span><span class="p">,</span> <span class="n">votes.Clinton</span><span class="o">/</span><span class="n">votes</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="m">1</span><span class="p">,</span> <span class="n">byrow</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>

<span class="c1">## Show Result</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;estimated proportion&#34;</span><span class="p">)</span>
<span class="nf">rownames</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;Trump&#34;</span><span class="p">,</span> <span class="s">&#34;Clinton&#34;</span><span class="p">)</span>
<span class="n">tab</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">##         estimated proportion</span>
<span class="c1">## Trump              0.4196854</span>
<span class="c1">## Clinton            0.4750039</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="confidence-interval-for-the-true-proportion-voting-for-trumpclinton">Confidence interval for the true proportion voting for Trump/Clinton</h3>
<p>Using the result in the section &ldquo;Central limit theory (CLT) on poll results&rdquo;, what is the 95% confidence interval for the true proportion voting for Trump based on the aggregated data? What is the 95% confidence interval for the proportion for Clinton?</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-R" data-lang="R"><span class="n">N</span> <span class="o">&lt;-</span> <span class="n">votes</span>

<span class="c1">## Calculate the 95% confidence interval for the proportion for Trump</span>
<span class="n">X</span> <span class="o">&lt;-</span> <span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> <span class="n">times</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="n">votes</span><span class="o">-</span><span class="n">votes.Trump</span><span class="p">,</span> <span class="n">votes.Trump</span><span class="p">))</span>
<span class="n">se</span> <span class="o">&lt;-</span> <span class="nf">sd</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">/</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">Q</span> <span class="o">&lt;-</span> <span class="nf">qnorm</span><span class="p">(</span><span class="m">0.975</span><span class="p">)</span>
<span class="n">interval.Trump</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="nf">mean</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">-</span><span class="n">Q</span><span class="o">*</span><span class="n">se</span><span class="p">,</span> <span class="nf">mean</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">+</span><span class="n">Q</span><span class="o">*</span><span class="n">se</span><span class="p">)</span>

<span class="c1">## Calculate the 95% confidence interval for the proportion for Clinton</span>
<span class="n">X</span> <span class="o">&lt;-</span> <span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> <span class="n">times</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="n">votes</span><span class="o">-</span><span class="n">votes.Clinton</span><span class="p">,</span> <span class="n">votes.Clinton</span><span class="p">))</span>
<span class="n">se</span> <span class="o">&lt;-</span> <span class="nf">sd</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">/</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">Q</span> <span class="o">&lt;-</span> <span class="nf">qnorm</span><span class="p">(</span><span class="m">0.975</span><span class="p">)</span>
<span class="n">interval.Clinton</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="nf">mean</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">-</span><span class="n">Q</span><span class="o">*</span><span class="n">se</span><span class="p">,</span> <span class="nf">mean</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">+</span><span class="n">Q</span><span class="o">*</span><span class="n">se</span><span class="p">)</span>

<span class="c1">## Show Result</span>
<span class="n">tab</span> <span class="o">&lt;-</span> <span class="nf">matrix</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">interval.Trump</span><span class="p">,</span> <span class="n">collapse</span><span class="o">=</span><span class="s">&#34; ~ &#34;</span><span class="p">),</span> <span class="nf">paste</span><span class="p">(</span><span class="n">interval.Clinton</span><span class="p">,</span> <span class="n">collapse</span><span class="o">=</span><span class="s">&#34; ~ &#34;</span><span class="p">)),</span> <span class="n">ncol</span><span class="o">=</span><span class="m">1</span><span class="p">,</span> <span class="n">byrow</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;95% confidence interval for the true proportion&#34;</span><span class="p">)</span>
<span class="nf">rownames</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;Trump&#34;</span><span class="p">,</span> <span class="s">&#34;Clinton&#34;</span><span class="p">)</span>
<span class="n">tab</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">##         95% confidence interval for the true proportion</span>
<span class="c1">## Trump   &#34;0.418702925705153 ~ 0.420667383633582&#34;        </span>
<span class="c1">## Clinton &#34;0.474009856955411 ~ 0.475997670788963&#34;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="spread-of-the-estimated-proportion-voting-for-trumpclinton">Spread of the estimated proportion voting for Trump/Clinton</h3>
<p>For illustrative purposes, we will assume that there are only two parties and call $p$ the proportion voting for Clinton and $1-p$ the proportion voting for Trump. We are interested in the spread $d=p-(1-p)=2p-1$. The spread is approximately $1-2\hat{p}$, where $\hat{p}$ is the estimated proportion based on the aggregated data. This implies that the standard error for the spread is twice as large than for $\hat{p}$. So our confidence interval for the spread $d$ is:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-R" data-lang="R"><span class="c1">## Exclude votes that are neither for Clinton nor for Trump</span>
<span class="n">N</span> <span class="o">&lt;-</span> <span class="n">votes.Clinton</span> <span class="o">+</span> <span class="n">votes.Trump</span>
<span class="n">p</span> <span class="o">&lt;-</span> <span class="n">votes.Clinton</span><span class="o">/</span><span class="n">N</span>

<span class="c1">## Calculate the confidence interval of spread d</span>
<span class="n">d</span> <span class="o">&lt;-</span> <span class="m">1-2</span><span class="o">*</span><span class="n">p</span>
<span class="n">se</span> <span class="o">&lt;-</span> <span class="nf">sqrt</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">N</span><span class="p">)</span> <span class="o">*</span> <span class="m">2</span>
<span class="n">Q</span> <span class="o">&lt;-</span> <span class="nf">qnorm</span><span class="p">(</span><span class="m">0.975</span><span class="p">)</span>
<span class="n">interval.spread</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="n">Q</span><span class="o">*</span><span class="n">se</span><span class="p">,</span> <span class="n">d</span><span class="o">+</span><span class="n">Q</span><span class="o">*</span><span class="n">se</span><span class="p">)</span>

<span class="c1">## Print out Result</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&#34;95% Confidence interval for the spread (d) is&#34;</span><span class="p">,</span> <span class="nf">paste</span><span class="p">(</span><span class="n">interval.spread</span><span class="p">,</span> <span class="n">collapse</span> <span class="o">=</span> <span class="s">&#34; ~ &#34;</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">## 95% Confidence interval for the spread (d) is -0.0639300252436611 ~ -0.0597297183214559</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="null-hypothesis">Null hypothesis</h3>
<p>We are interested in testing $H_{0}: d=0$ versus $H_{a}: d \neq 0$. Create your test statistic for this test, and obtain the p-value based on the aggregrated data.</p>
<blockquote>
<p>The test statistics for $d$ can be formulated into a function of $p$ since $d = 1-2p$</p>
<p>$$
t-statistics=\frac{1-2\times\hat{p}}{2\times\sqrt{\frac{\hat{p}(1-\hat{p})}{N}}}
$$</p>
<p>where $p$ is the proportion voting for Clinton and $N$ is the sample size</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-R" data-lang="R"><span class="n">N</span> <span class="o">&lt;-</span> <span class="n">votes.Clinton</span> <span class="o">+</span> <span class="n">votes.Trump</span>
<span class="n">p</span> <span class="o">&lt;-</span> <span class="n">votes.Clinton</span><span class="o">/</span><span class="n">N</span>

<span class="c1">## Define t-statistics function for spread d</span>
<span class="n">tstat</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">p</span><span class="p">){</span> <span class="nf">return</span><span class="p">((</span><span class="m">1-2</span><span class="o">*</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="m">2</span><span class="o">*</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">N</span><span class="p">)))</span> <span class="p">}</span>

<span class="c1">## Calculate the t-statistics for spread</span>
<span class="n">obststat</span> <span class="o">&lt;-</span> <span class="nf">tstat</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

<span class="c1">## Calculate p-value using normal approximation</span>
<span class="n">righttail</span> <span class="o">&lt;-</span> <span class="m">1</span> <span class="o">-</span> <span class="nf">pnorm</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">obststat</span><span class="p">))</span>
<span class="n">lefttail</span> <span class="o">&lt;-</span> <span class="nf">pnorm</span><span class="p">(</span><span class="o">-</span><span class="nf">abs</span><span class="p">(</span><span class="n">obststat</span><span class="p">))</span>
<span class="n">npval</span> <span class="o">&lt;-</span> <span class="n">lefttail</span> <span class="o">+</span> <span class="n">righttail</span>

<span class="c1">## Show Result</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&#34;The p-value based on the aggregrated data is&#34;</span><span class="p">,</span> <span class="n">npval</span><span class="p">,</span> 
    <span class="s">&#34;.\nThat is, the evidence is strong to reject null hypothesis, and thus spread (d) is not zero.&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">## The p-value based on the aggregrated data is 0 .</span>
<span class="c1">## That is, the evidence is strong to reject null hypothesis, and thus spread (d) is not zero.</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="references">References</h2>
<ul>
<li>Data Science, Statistics, and R (資料科學、統計與 R) Fall 2017, lectured by <a href="http://ghuang.stat.nctu.edu.tw/">Dr. Guan-Hua Huang (黃冠華)</a></li>
</ul>
    
	</div>
  <footer class="article-footer clearfix">
  

<div class="article-tags">
  <span></span>
  
  <a href="https://binnz.github.io/tags/statistics">Statistics</a>
  
  <a href="https://binnz.github.io/tags/r">R</a>
  
</div>





<div class="article-categories">
  <span></span>
  
  <a class="article-category-link" href="https://binnz.github.io/categories/programming">Programming</a>
  
</div>



  <div class="article-share" id="share">
    <div data-url="https://binnz.github.io/post/2018-09-10-r2/" data-title="Practice in R: Monte Carlo Simulation &amp; Central Limit Theorem (CLT)" data-tsina="" class="share clearfix">
    </div>
  </div>
</footer>

	</article>
  


<section class="comment">
<div id="disqus_thread"></div>
</section>
<script>
  <!-- detect whether Disuqs can load -->
  var xhr = new XMLHttpRequest();
  xhr.open('GET', '//disqus.com/next/config.json?' + new Date().getTime(), true);
  xhr.timeout = 3000; 

  xhr.onload = function() { 


var disqus_config = function () {
this.page.url = "https://binnz.github.io/post/2018-09-10-r2/";
this.page.identifier = "https://binnz.github.io/post/2018-09-10-r2/";
};
(function() { 
var d = document, s = d.createElement('script');

s.src = '//disc.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
}
  xhr.ontimeout = function() {
  <!-- cannot load Disqus, skip it. -->
  return;
}
xhr.send(null);
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


</div>

    <div class="openaside"><a class="navbutton" href="#" title="Show SideBar"></a></div>
<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide SideBar"></a></div>
<aside class="clearfix">
  

<div class="categorieslist">
  <p class="asidetitle">Categories</p>
  <ul>
    
    <li><a href="https://binnz.github.io/categories/install" title="install">install<sup>2</sup></a></li>
    
    <li><a href="https://binnz.github.io/categories/life" title="life">life<sup>1</sup></a></li>
    
    <li><a href="https://binnz.github.io/categories/notes" title="notes">notes<sup>50</sup></a></li>
    
    <li><a href="https://binnz.github.io/categories/programming" title="programming">programming<sup>25</sup></a></li>
    
    <li><a href="https://binnz.github.io/categories/projects" title="projects">projects<sup>2</sup></a></li>
    
    <li><a href="https://binnz.github.io/categories/publications" title="publications">publications<sup>1</sup></a></li>
    
  </ul>
</div>



  

<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
      
			<li><a href="https://binnz.github.io/tags/ANDROID" title="android">android<sup>1</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/APACHE-PIG" title="apache-pig">apache-pig<sup>1</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/ASSOCIATION-ANALYSIS" title="association-analysis">association-analysis<sup>9</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/BEER" title="beer">beer<sup>1</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/CLASSIFICATION" title="classification">classification<sup>9</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/CLUSTERING" title="clustering">clustering<sup>19</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/CONFERENCE" title="conference">conference<sup>1</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/DATA-MINING" title="data-mining">data-mining<sup>64</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/DATA-SCIENCE" title="data-science">data-science<sup>1</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/DATABASE" title="database">database<sup>1</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/DEEP-LEARNING" title="deep-learning">deep-learning<sup>2</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/ELASTICSEARCH" title="elasticsearch">elasticsearch<sup>2</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/GRAPH" title="graph">graph<sup>12</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/HADOOP" title="hadoop">hadoop<sup>1</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/INFORMATION-RETRIEVAL" title="information-retrieval">information-retrieval<sup>1</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/JAVA" title="java">java<sup>5</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/MACHINE-LEARNING" title="machine-learning">machine-learning<sup>5</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/NEURAL-NETWORK" title="neural-network">neural-network<sup>2</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/NLP" title="nlp">nlp<sup>4</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/NLTK" title="nltk">nltk<sup>1</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/PYTHON" title="python">python<sup>15</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/R" title="r">r<sup>4</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/RELATION-ALGEBRA" title="relation-algebra">relation-algebra<sup>1</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/SCIKIT-LEARN" title="scikit-learn">scikit-learn<sup>5</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/SPARK" title="spark">spark<sup>9</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/SQL" title="sql">sql<sup>3</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/STATISTICS" title="statistics">statistics<sup>5</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/STREAMING" title="streaming">streaming<sup>1</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/TIME-SERIES" title="time-series">time-series<sup>2</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/TRAVEL" title="travel">travel<sup>1</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/UNIT-TEST" title="unit-test">unit-test<sup>1</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/VBA" title="vba">vba<sup>1</sup></a></li>
      
			<li><a href="https://binnz.github.io/tags/WINDOWS" title="windows">windows<sup>1</sup></a></li>
      
		</ul>
</div>



  
  <div class="archiveslist">
    <p class="asidetitle">Archives</p>
    <ul class="archive-list">
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2021-06">2021年06月</a><span class="archive-list-count">1</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2020-05">2020年05月</a><span class="archive-list-count">12</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2019-09">2019年09月</a><span class="archive-list-count">1</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2018-09">2018年09月</a><span class="archive-list-count">4</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2018-08">2018年08月</a><span class="archive-list-count">1</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2018-06">2018年06月</a><span class="archive-list-count">2</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2018-05">2018年05月</a><span class="archive-list-count">4</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2018-04">2018年04月</a><span class="archive-list-count">5</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2018-03">2018年03月</a><span class="archive-list-count">5</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2018-01">2018年01月</a><span class="archive-list-count">2</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2017-12">2017年12月</a><span class="archive-list-count">1</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2017-11">2017年11月</a><span class="archive-list-count">1</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2017-10">2017年10月</a><span class="archive-list-count">1</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2017-09">2017年09月</a><span class="archive-list-count">10</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2017-08">2017年08月</a><span class="archive-list-count">2</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2017-07">2017年07月</a><span class="archive-list-count">4</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2017-05">2017年05月</a><span class="archive-list-count">3</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2017-04">2017年04月</a><span class="archive-list-count">2</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://binnz.github.io/post/#2017-03">2017年03月</a><span class="archive-list-count">20</span>
      </li>
      
    </ul>

  </div>


  

<div class="tagcloudlist">
  <p class="asidetitle">Tags Cloud</p>
  <div class="tagcloudlist clearfix">
    
    <a href="https://binnz.github.io/tags/android" style="font-size: 12px;">android</a>
    
    <a href="https://binnz.github.io/tags/apache-pig" style="font-size: 12px;">apache-pig</a>
    
    <a href="https://binnz.github.io/tags/association-analysis" style="font-size: 12px;">association-analysis</a>
    
    <a href="https://binnz.github.io/tags/beer" style="font-size: 12px;">beer</a>
    
    <a href="https://binnz.github.io/tags/classification" style="font-size: 12px;">classification</a>
    
    <a href="https://binnz.github.io/tags/clustering" style="font-size: 12px;">clustering</a>
    
    <a href="https://binnz.github.io/tags/conference" style="font-size: 12px;">conference</a>
    
    <a href="https://binnz.github.io/tags/data-mining" style="font-size: 12px;">data-mining</a>
    
    <a href="https://binnz.github.io/tags/data-science" style="font-size: 12px;">data-science</a>
    
    <a href="https://binnz.github.io/tags/database" style="font-size: 12px;">database</a>
    
    <a href="https://binnz.github.io/tags/deep-learning" style="font-size: 12px;">deep-learning</a>
    
    <a href="https://binnz.github.io/tags/elasticsearch" style="font-size: 12px;">elasticsearch</a>
    
    <a href="https://binnz.github.io/tags/graph" style="font-size: 12px;">graph</a>
    
    <a href="https://binnz.github.io/tags/hadoop" style="font-size: 12px;">hadoop</a>
    
    <a href="https://binnz.github.io/tags/information-retrieval" style="font-size: 12px;">information-retrieval</a>
    
    <a href="https://binnz.github.io/tags/java" style="font-size: 12px;">java</a>
    
    <a href="https://binnz.github.io/tags/machine-learning" style="font-size: 12px;">machine-learning</a>
    
    <a href="https://binnz.github.io/tags/neural-network" style="font-size: 12px;">neural-network</a>
    
    <a href="https://binnz.github.io/tags/nlp" style="font-size: 12px;">nlp</a>
    
    <a href="https://binnz.github.io/tags/nltk" style="font-size: 12px;">nltk</a>
    
    <a href="https://binnz.github.io/tags/python" style="font-size: 12px;">python</a>
    
    <a href="https://binnz.github.io/tags/r" style="font-size: 12px;">r</a>
    
    <a href="https://binnz.github.io/tags/relation-algebra" style="font-size: 12px;">relation-algebra</a>
    
    <a href="https://binnz.github.io/tags/scikit-learn" style="font-size: 12px;">scikit-learn</a>
    
    <a href="https://binnz.github.io/tags/spark" style="font-size: 12px;">spark</a>
    
    <a href="https://binnz.github.io/tags/sql" style="font-size: 12px;">sql</a>
    
    <a href="https://binnz.github.io/tags/statistics" style="font-size: 12px;">statistics</a>
    
    <a href="https://binnz.github.io/tags/streaming" style="font-size: 12px;">streaming</a>
    
    <a href="https://binnz.github.io/tags/time-series" style="font-size: 12px;">time-series</a>
    
    <a href="https://binnz.github.io/tags/travel" style="font-size: 12px;">travel</a>
    
    <a href="https://binnz.github.io/tags/unit-test" style="font-size: 12px;">unit-test</a>
    
    <a href="https://binnz.github.io/tags/vba" style="font-size: 12px;">vba</a>
    
    <a href="https://binnz.github.io/tags/windows" style="font-size: 12px;">windows</a>
    
  </div>
</div>



  

</aside>
</div>

  </div>
  <footer><div id="footer" >
  <div class="line">
    <span></span>
    
    <div style='background:no-repeat url("https://binnz.github.io/img/US-MT-EPS-02-6001.png") left top;-webkit-background-size:6.875em 6.875em;-moz-background-size:6.875em 6.875em;background-size:6.875em 6.875em;' class="author" ></div>
  </div>
  <section class="info">
    <p>hehe</p>
  </section>
  <div class="social-font clearfix">
    <a href='http://weibo.com/coderzh' target="_blank" title="weibo"></a>
    <a href='https://twitter.com/coderzh' target="_blank" title="twitter"></a>
    <a href='https://github.com/binnz' target="_blank" class="icon-github" title="github"></a>
    <a href='https://www.facebook.com/coderzh' target="_blank" title="facebook"></a>
    <a href='https://www.linkedin.com/coderzh' target="_blank" title="linkedin"></a>
  </div>
  <p class="copyright">Powered by <a href="http://gohugo.io" target="_blank" title="hugo">hugo</a> and Theme by <a href="https://github.com/coderzh/hugo-pacman-theme" target="_blank" title="hugo-pacman-theme">hugo-pacman-theme</a> © 2021
    
    <a href="https://binnz.github.io/" title="California Dreaming">California Dreaming</a>
    
  </p>
</div>
</footer>
  <script src="https://binnz.github.io/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
done = false;
$(document).ready(function(){
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize();
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  $('form.search').on('submit', function (event) {
    if (false === done) {
      event.preventDefault();
      var orgVal = $(this).find('#search').val();
      $(this).find('#search').val('site:https:\/\/binnz.github.io\/ ' + orgVal);
      done = true;
      $(this).submit();
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>

<script type="text/javascript">
$(document).ready(function(){
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://b.bshare.cn/barCode?site=weixin&url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});
</script>





</body>
</html>
